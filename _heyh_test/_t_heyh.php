<?php
set_time_limit(3600);
include_once ('/disk/data/htdocs232/poco/pai/mobile/poco_pai_common.inc.php');

$chat_user_obj = POCO::singleton('pai_mall_seller_class');

$sql_str = "SELECT to_user_id FROM test.data_analysis_log_tbl WHERE to_user_role = '' GROUP BY to_user_id";
$result = db_simple_getdata($sql_str, FALSE, 101);
foreach($result AS $key=>$val)
{
    $result = $chat_user_obj->get_first_profile_m_level_by_user_id($val['to_user_id']);
    var_dump($result);
    if($result['type_id'])
    {
        $sql_str = "UPDATE test.data_analysis_log_tbl SET to_user_role='{$result[type_id]}' WHERE to_user_id=$val[to_user_id]";
        echo $sql_str . "<BR>";
        db_simple_getdata($sql_str, FALSE, 101);
    }
}

exit();
var_dump(version_compare('3.1.10', '3.1.10', '='));
exit();
exit();

$return_query = "type_id%3D40%26detail%5B90%5D%3D0%26detail%5B289%5D%3D0%26detail%5B309%5D%3D0%26p_goodat%3D%b8%f6%d0%d4%d0%b4%d5%e6%26status%3D1%26is_show%3D1%26city%3D101029%26location_id%3D101029001%26is_black%3D0%26prices_list%3D0%26user_id%3D0%26s_action%3Dgoods";
parse_str(urldecode($return_query), $data);
print_r($data);
$data['debug'] = 't';
$mall_seller_obj = POCO::singleton('pai_mall_goods_class');
$search_result = $mall_seller_obj->user_search_goods_list($data, $limit_str);

print_r($search_result);


exit();
$obj = POCO::singleton('pai_chat_user_info');
$obj->redis_get_user_info(127211);
exit();
$update_obj = POCO::singleton('pai_app_update_class');

$sql_str = "SELECT user_id, nickname, cellphone FROM pai_db.pai_user_tbl WHERE role='cameraman'";
$result = db_simple_getdata($sql_str, FALSE, 101);
foreach($result AS $key=>$val) {
    if (!$update_obj->check_user_is_update($val[user_id]))
    {
        echo "�û�ID��" . $val['user_id'] . " �û�����" . $val['nickname'] . "<BR>";
    }
}

exit();
$qrcode_obj = POCO::singleton('pai_activity_code_class');
$url = 'http://yp.yueus.com/mobile/action/check_qrcode.php?event_id=57209&enroll_id=800407&code=447033&hash=ad20fc43b4d29b2dd5e5';
$user_id = 100021;
$return_array = $qrcode_obj->verify_qrcode_url($user_id, $url, 'customer');
print_r($return_array);
exit();
$sql_str = "SELECT user_id FROM pai_db.pai_user_tbl WHERE user_id  >= 100000";
$result = db_simple_getdata($sql_str, FALSE, 101);
$count = 0;
$is_update = 0;
foreach($result AS $key=>$val)
{
    $obj = POCO::singleton('pai_app_update_class');
    $status = $obj->check_user_is_update($val['user_id']);
    //echo $val['user_id'] . " : " . $status . "<BR>";
    if($status == 6) $is_update++;
    $count++;
}
echo $is_update . "<BR>";
echo $count;


exit();
$obj = POCO::singleton('pai_chat_user_info');
$obj->redis_get_user_info(127211);

exit();
/*$sql_str = 'SELECT L.to_date_id AS user_id, COUNT(L.to_date_id) AS C
FROM event_db.event_details_tbl AS R, event_db.event_date_tbl AS L
WHERE L.event_id > 0 AND L.event_id = R.event_id AND R.event_status = "2" AND R.add_time > 1435939200
AND L.to_date_id NOT IN ("100006","100021","100042","100044","100062","100098","100129","100149","100161","100168","100174","100178","100200","100207","100223","100229","100257","100262","100294","100361","100406","100420","100492","100519","100537","100722","100768","100769","100787","100911","100978","101003","101118","101131","101299","101355","101488","101555","101666","101763","102024","102038","102159","102309","102575","102651","102728","102823","103069","103112","103146","103281","103460","103514","103515","103585","103586","103965","104212","104278","104282","104369","104370","104741","104889","105047","105197","105460","105468","105491","105697","105983","106023","106028","106032","106047","106048","106095","106200","106201","106220","106224","106226","106229","106233","106269","106328","106331","106334","106356","106357","106411","106424","106428","106429","106439","106443","106444","106446","106447","106450","106453","106457","106458","106459","106462","106464","106465","106477","106497","106545","106553","106555","106559","106569","106572","106576","106586","106587","106590","106591","106592","106659","106685","106687","106688","106694","106695","106702","106704","106718","106724","106955","107027","107191","107333","107482","107509","107745","107850","107875","107893","108032","108135","108224","108226","108429","108470","108500","108710","108861","109067","109266","109288","109311","109330","109479","109543","109804","109928","109968","109984","110033","110035","110133","110266","110331","110431","110484","110642","110661","110808","110896","110944","110986","111140","111388","111486","111488","111617","111659","111769","111920","111947","111989","112685","112688","112702","112786","112874","112991","113106","113231","113278","113435","113437","113439","113442","113447","113450","113453","113474","113490","113505","113651","113668","113712","113740","113981","113992","114036","114066","114068","114081","114102","114112","114198","114213","114218","114222","114242","114245","114246","114261","114265","114315","114377","114396","114397","114533","114537","114554","114557","114567","114584","114587","114588","114591","114592","114593","114595","114597","114598","114614","114640","114650","114653","114657","114659","114664","114667","114714","114754","114783","114784","114789","114799","114800","114801","114930","114935","114943","114946","114976","114978","114980","115031","115069","115070","115071","115191","115192","115193","115195","115196","115277","115317","115478","115534","115536","115537","115543","115547","115551","115612","115625","115626","115628","115687","115691","115694","115696","115702","115749","116038","116054","116072","116134","116161","116207","116212","116270","116654","117152","117258","117318","117378","117399","117414","117415","117481","117495","117650","117660","117735","117763","117888","118032","118059","118197","118270","118310","118564","118617","118633","118979","118982","119011","119410","119438","119444","119482","120071")
GROUP BY L.to_date_id
ORDER BY C DESC;';*/

$sql_str = 'SELECT L.to_date_id AS user_id, COUNT(L.to_date_id) AS C
FROM event_db.event_details_tbl AS R, event_db.event_date_tbl AS L
WHERE L.event_id > 0 AND L.event_id = R.event_id AND R.event_status = "2" AND R.add_time > 1435680000
AND L.to_date_id NOT IN ("105468","113740","111486","114036","110808","106659","106695","110133","114081","105771","106639","114591","100406","114587","114265","113435","107355","114068","108710","114396","105491","100020","114554","114537","113442","114667","114783","114587","104008","113505","113505","114588","113651","116212","114592","103586","113447","105411","114595","114799","114036","113505","114588","106220","113439","106328","100420","114222","104278","100020","113453","100020","113651","113740","114592","113447","104369","100013","100013","114567","114667","100168","114943","100020","115071","114588","114588","113231","100168","113992","115196","115696","115612","113447","115534","100410","113668","106233","100207","113435","113450","100168","106702","100410","104428","106694","100519","114112","113231","106459","113992","113447","113668","113651","114245","109804","114657","113712","106555","114650","113490","113437","114112","113437","113453","114245","113442","114222","114930","113712","115195","113453","114584","113439","113981","106556","113442","100597","114584","113439","113490","111659","114591","114554","114242","114102","106201","106028","103957","108710","109252","105852","101355","107333","108548","109311","109968","110035","110033","109928","114595","106450","108429","106159","106447","111388","106477","113981","114066","114591","114377","115628","114592","114595","115702","114591","114650","100207","100492","110133","108226","103056","107850","107850","114460","108429","116072","113505","114597","104008","114597","113651","103585","103460","114591","114588","113437","113447","116038","113231","115407","100098","116212","113668","113435","113278","113439","113651","114591","114588","113437","113447","104374","116038","106047","116038","113231","113668","106200","113435","113278","117735","116054","113490","106229","116134","106464","116161","113453","116212","116270","113712","108333","113474","100099","113474","115537","113740","115478","113992","116054","113490","116134","114315","116161","100616","113442","113442","113712","116161","113453","116270","113992","110133","117414","116270","113450","113450","117414","117414","108920","108429","100207","111488","115031","101593","106047","106331","100174","113740","106465","106444","103460","106556","106446","106545","106591","100207","114653","108429","114198","106586","114036","106569","106569","107850","106659","114557","103586","113740","115547","104369","106587","100168","113740","113740","106559","106591","114246","114664","113651","116038","113490","116054","112702","113231","113740","113740","114801","116134","116134","113442","113453","116161","108226","114943","114567","115196","114588","116134","114714","117495","113651","116038","113740","116212","113490","116054","113231","111769","113453","117735","116161","114588","106428","106453","114714","113447","106572","114597","106576","114265","115193","114213","115191","114800","116161","115551","114588","113447","117414","114597","117414","114598","114714","116270","113437","113439","113712","114598","116270","113437","113712","113712","113439","113439","113668","113668","100978","101488","113740","114537","114946","114640","106028","112702","109804","112688","115069","115071","115195","115192","115625","115536","115626","117414","117414","114595","115691","114588","115694","113981","100168","100207","114800","108032","113439","102038","114593","113992","106032","110808","113435","114598","111659","102309","116270","116270","106023","113474","113474","106685","113505","116054","113437","114591","106411","114592","100174","115317","117414","107191","114595","103460","114588","101666","101763","113981","108226","111488","114593","113992","113435","114598","116270","117152","113474","105983","113450","116054","106226","106592","113442","114591","106220","106457","116161","106704","117495","106592","115543","106048","116161","106356","113668","106590","113453","113447","114935","114592","115317","116161","113668","114597","114567","114714","116038","116134","114597","114714","116038","116134","115749","103515","105491","106497","100406","109804","103515","100787","116212","116212","101488","100361","114595","114595","106357","113651","115317","114081","113992","114397","116134","103585","115070","116038","113981","113981","116161","106048","115696","114587","114667","114587","113231","112702","106226","114593","116270","116270","114591","116054","110133","115687","115317","113992","100207","114584","113447","104278","113447","103515","114598","114598","114592","114592","114597","114597","113474","114714","113439","114588","117414","116134","116038","116161","113231","114593","112702","104278","117399","116270","114591","116054","111486","116054","114584","106424","106458","116212","106477","103281","116212","106553","113447","114218","113474","115612","113474","114714","114789","113439","102024","114588","103515","114588","117414","113740","110266","102651","100519","107191","113740","114657","114567","115547","104278","114754","115702","107191","100042","112685","114261","107509","116161","106424","113712","113712","114930","117481","113651","112702","100519","116134","114584","113505","116161","113651","113651","116134","109804","114584","109543","113505","114593","114659","116054","114783","114799","114592","115702","114595","115534","116038","116038","115628","115317","115694","114657","114396","114377","110896","115547","113490","114598","116212","116212","113435","114587","114588","114591","114714","114593","116054","106688","106047","106224","106439","114592","114595","116038","115317","113490","114598","113435","114587","114714","115031","113740","113278","113278","100178","116654","100420","106955","101003","111989","114068","110133","114653","106450","100168","114198","100098","100168","113447","114591","114593","113712","113453","114198","113435","111617","113668","106555","113981","113651","114584","114198","108500","114598","114598","116134","100207","116134","114714","107850","106334","113505","106269","113442","100044","116038","114588","113231","116072","113447","114591","114593","113712","113453","118310","100537","113435","113668","113981","113651","114584","105491","114714","113442","108226","116038","114588","114588","113437","113437","108470","113490","113490","113231","113992","113450","113450","103069","104889","100178","118310","115069","114784","114222","110133","114198","101763","106200","105491","106200","106328","106328","113740","101763","114943","114943","106688","106569","106694","113740","100223","106443","100722","100492","114315","106429","113435","108224","113435","107027","106462","113450","113447","113712","106459","113231","106687","114554","114595","115537","114595","114591","114066","116072","114946","115071","110331","116212","110331","115625","114567","114714","114714","101131","114593","115192","114593","114588","114102","114112","114242","114245","114588","113740","114588","115277","114557","117650","113505","113505","113450","114533","100420","114640","114591","114930","114036","114592","115628","114592","115702","114598","102309","114598","103586","115691","115196","114801","114664","115551","114650","106695","106702","106545","106233","113740","102728","106048","116161","106688","106704","116161","106659","106028","116038","114081","106032","114246","116038","106201","115317","115317","114213","114587","114587","106694","116161","106229","106201","106334","115696","106331","106465","106458","106023","100769","113668","113668","115626","106428","113668","106444","113278","113278","106447","115694","106464","105983","106446","116134","116134","114597","114597","116054","116054","107850","100207","117399","116072","116072","106586","100062","106590","106591","118310","116212","110331","118310","108226","109804","113740","110133","117399","117415","113435","106220","113712","106028","116054","106465","110808","116054","113278","115193","115193","113740","106576","113490","115543","113981","116161","113453","114588","117660","114218","114593","100229","114537","114667","114595","114595","115317","106226","116038","113442","113505","106453","113505","116212","114587","114592","114597","113278","106328","106439","106553","114584","106572","113447","114598","106685","114714","103585","113450","106444","114261","114265","114783","113435","114799","113712","118617","116134","116134","114935","113490","113981","115070","104370","115191","115195","112874","115536","116161","115696","113453","114588","118633","114593","117495","115317","117318","103146","105197","100768","100406","105491","117735","100911","109288","108226","113740","113740","108135","104889","100207","106462","116212","106687","115534","115547","114653","103069","114396","106048","101666","110431","106032","106047","114650","116038","104212","100769","109804","114653","100207","115031","118633","100420","113442","106457","110896","106356","114587","113740","113437","106357","106555","102024","115069","114592","114597","111617","106224","106200","111617","106687","115702","113106","115547","115277","106334","114584","106429","114567","113447","106592","106559","100420","100420","106569","106694","108032","114784","107482","114801","115196","110944","100420","118617","114598","109330","104278","113450","106028","117735","117735","118059","100223","109479","103515","100168","108226","109804","110133","100257","103460","107191","112702","107850","109543","106023","101555","113447","115317","114584","106201","106591","116134","116134","109479","116207","114592","102159","113106","106450","114593","114595","106424","106444","112786","106464","113439","113447","106704","113992","115317","108710","107191","106695","106477","114584","100420","114112","113439","114081","114800","114068","106459","114397","114554","114557","114592","116212","114593","100174","106724","100149","100200","115749","118633","104282","110642","118564","100207","112991","117650","106718","109804","110133","100207","117481","114567","114657","104282","106095","114664","114640","114946","106702","108226","114976","115478","115071","106477","106233","106224","114567","106331","106443","113712","106465","113651","106444","113668","109984","106702","106685","115628","106659","110484","106047","107745","107850","106592","115191","106428","100161","113981","116054","116134","114588","106226","106233","109067","106356","113231","106458","118617","106428","113712","106233","106586","106659","114066","114533","106447","115543","115625","115537","113651","113668","114789","113981","116054","106048","106032","106357","106439","106446","106545","116134","100420","114588","100978","111617","111388","107191","113231","116134","108226","110133","112685","104889","116072","117495","110944","103514","108226","102038","100537","109804","107850","113740","114567","116212","101763","100042","111947","115277","102823","101355","107333","109311","109968","110035","110033","109928","103585","106704","114265","114213","114659","114943","100200","115195","105460","100294","105047","115551","100262","114978","113740","110642","100769","106688","114246","114789","112702","105697","119438","119410","116212","106724","100129","115069","115193","114245","114242","115534","117378","119444","106592","111920","118617","111617","113437","113435","113450","116161","114593","113505","115317","107509","114598","114714","107509","105491","100420","113490","110642","118633","111617","113447","105460","107509","100044","118979","113437","113435","113740","113450","116161","114593","114567","104278","115317","107893","114598","114714","100406","117763","105491","113490","113447","107850","116072","118982","119482","114198","100519")
GROUP BY L.to_date_id
ORDER BY C DESC;';

$result = db_simple_getdata($sql_str, FALSE);
$pass_result = array();
foreach($result AS $key=>&$val)
{
    if(!check_user_pass($val['user_id']))
    {
        unset($val);
    }else{
        $val['����'] = get_user_location_id($val['user_id']);
    }
}
//print_r($result);

echo "<table>";
foreach($result AS $key=>$val)
{
    echo "<tr>";
    echo "<td>" . $val[user_id] . "</td><td>" . $val['C']  . " </td><td>" . $val['����'] . "</td>";
    echo "</tr>";
}
echo "</table>";

function check_user_pass($user_id)
{
    $user_id = (int)$user_id;
    $sql_str = "SELECT * FROM pai_db.pai_model_audit_tbl WHERE user_id='{$user_id}'";
    $result = db_simple_getdata($sql_str, TRUE, 101);
    if($result['is_approval'] == 1)
    {
        return TRUE;
    }else{
        return FALSE;
    }
}

function get_location_by_id($location_id)
{
    $array_location[101001001] = '����';
    $array_location[101029001] = '����';
    $array_location[101003001] = '�Ϻ�';
    $array_location[101022001] = '�ɶ�';
    $array_location[101004001] = '����';
    $array_location[101015001] = '����';
    $array_location[101024001] = '�½�';

    return $array_location[$location_id];
}

function get_user_location_id($user_id)
{
    $sql_str = "SELECT location_id
                FROM `pai_db`.`pai_user_tbl`
                WHERE user_id = $user_id";
    $result = db_simple_getdata($sql_str, TRUE, 101);
    return get_location_by_id($result['location_id']);
}
exit();
define('TEST_SENDSERVER_SWITCH', 1);
$send_data = '';
$str = "ԼԼ������7�µ��Ƴ�ȫ���̼Ұ�app���յ���Ϣ�ĸ�λ�����ȳ�ΪԼԼ��פ�̼ҡ������ڵ�����¼���̼����ϼ���������÷�����Ŀ��������ȫ��ԼԼapp���̼Ұ�app���ߺ��һʱ���ƹ������ʹ��ԭԼԼ�˺ź����룬��¼ȫ���̼�ƽ̨ s.yueus.com ���������ʣ���鿴�̼�ƽ̨��ҳ�ײ�����˵�������µ�ͷ���4000-82-9003";
$push_obj = POCO::singleton('pai_information_push');

$send_data[media_type] = 'text';
$send_data[content] = $str;

var_dump($push_obj->message_sending_for_system(100091, $send_data, 10000, 'yueseller'));
var_dump($push_obj->message_sending_for_system(100091, $send_data));
exit();

$send_data[media_type] = 'card';
$send_data[card_style] = '2';
$send_data[card_text1] = '11111';
$send_data[card_text2] = '22222';
$send_data[card_title] = '33333';

$push_obj = POCO::singleton('pai_information_push');
var_dump($push_obj->card_send_for_order(100008, 'yuebuyer', 100008, 'yueseller', $send_data, $send_data, 10));
var_dump($push_obj->card_send_for_order(100008, 'yuebuyer', 100008, 'yueseller', $send_data, $send_data, 10, 1));
exit();
$tongji_obj = POCO::singleton('pai_tongji_class');
echo $tongji_obj->get_db_table_name();

$img_url = "http://www.poco.cn";
$link_url = "http://www.yueus.com";
$interface_name = "get_hot_data";
$location_id = '10000';
$user_id   = '100008';
$tongji_obj->add_tongji_log($img_url, $link_url, $interface_name, $location_id, $user_id);


exit();
$sendServer_obj = POCO::singleton('pai_chat_user_info');
$sendServer_obj->introduction_all_user_data();

exit();
$url = "yueyue://goto?type=inner_app&url=http%3A%2F%2Fyp.yueus.com%2Fmobile%2Fm2predev%2Ftopic%2F%3Ftopic_id%3D152&showtitle=1";
$array_url = parse_url($url);
print_r($array_url);

exit();
set_time_limit(3600);

//include_once ('/disk/data/htdocs232/poco/pai/yue_admin/audit/include/Classes/PHPExcel.php');
include_once ('/disk/data/htdocs232/poco/pai/mobile/poco_pai_common.inc.php');
include_once ("/disk/data/htdocs232/poco/php_common/poco_location_fun.inc.php");
include_once('/disk/data/htdocs232/poco/pai/yue_admin/cms/cms_common.inc.php');


$score_obj              = POCO::singleton ('pai_score_rank_class');
$date_obj               = POCO::singleton ('pai_date_rank_class');
$user_obj               = POCO::singleton ('pai_model_style_v2_class');
$pic_obj                = POCO::singleton ('pai_pic_class');
$pic_score_obj          = POCO::singleton ('pai_score_rank_class');
$model_card_obj         = POCO::singleton ('pai_model_card_class');
$cameraman_card_obj     = POCO::singleton ('pai_cameraman_card_class');
$rank_event_obj         = POCO::singleton('pai_rank_event_class');
$pai_user_obj           = POCO::singleton ( 'pai_user_class' );
$pai_cms_parse_obj      = POCO::singleton( 'pai_cms_parse_class' );
$cms_obj                = new cms_system_class();

//������
$role = $pai_user_obj->check_role($user_id);

//��ʼ�����
if(empty($role))        $role         = 'cameraman';
if(empty($location_id)) $location_id  = '101029001';

$ranking_array  = $rank_event_obj->get_rank_event_by_location_id($location_id, $role);
$data           = $pai_cms_parse_obj->cms_parse_by_array($ranking_array);

print_r($data);


exit();
$send_data ['media_type'] = 'card';
$send_data ['card_style'] = 2;
$send_data ['card_text1'] = '��������������������������������������������������������������������������������������������������������';
$send_data ['card_title'] = '�ȴ�ģ�ؽ���';
$send_data ['link_url']   = 'XXXXX';
$send_data ['wifi_url']   = 'XXXXX';

$push_obj = POCO::singleton('pai_information_push');
print_r($push_obj->send_msg_for_system(10000, 100008, $send_data));

?>