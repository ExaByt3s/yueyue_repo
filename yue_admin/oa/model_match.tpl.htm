<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="js/DatePicker/WdatePicker.js"></script>
<link rel="stylesheet" type="text/css" href="./css/style.css">
<link type="text/css" href="css/jquery-ui-1.8.17.custom.css" rel="stylesheet" />
<link type="text/css" href="css/jquery-ui-timepicker-addon.css" rel="stylesheet" />
<script type="text/javascript" src="js/jquery-ui-1.8.17.custom.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="js/jquery-ui-timepicker-zh-CN.js"></script>
<script type="text/javascript">
    $(function () {
        $(".ui_timepicker").datetimepicker({
            //showOn: "button",
            //buttonImage: "./css/images/icon_calendar.gif",
            //buttonImageOnly: true,
            showSecond: true,
            timeFormat: 'hh:00:00',
            stepHour: 1,
            stepMinute: 1,
            stepSecond: 1
        })
    })
    </script>
<title>OA</title>
<style type="text/css">
.input-text {
	width:500px;
}
.table-list {
	clear: both;
}
.table-list .input-text {
	width: 100px;
}
.table-list .table {
	float: left;
	margin-top: 20px;
 +margin-left:5px;
}
.box {
	position:absolute;
	width:600px;
	left:50%;
	height:auto;
	z-index:100;
	background-color:#fff;
	border:1px #8FA4F5 solid;
	padding:1px;
}
.box h2 {
	height:25px;
	font-size:14px;
	background-color:#3366cc;
	position:relative;
	padding-left:10px;
	line-height:25px;
	color:#fff;
}
.box h2 a {
	position:absolute;
	right:5px;
	font-size:12px;
	color:#fff;
}
.box .mainlist {
	padding:10px;
}
.box .mainlist li {
	height:24px;
	line-height:24px;
	list-style:none
}
.box .mainlist li span {
	margin:0 5px 0 0;
	font-family:"宋体";
	font-size:12px;
	font-weight:400;
	color:#ddd;
}
#TB_overlayBG {
	background-color:#666;
	position:absolute;
	z-index:99;
	left:0;
	top:0;
	display:none;
	width:100%;
	height:100%;
	opacity:0.5;
	filter: alpha(opacity=50);
	-moz-opacity: 0.5;
}
.ajax_load {
	height:100px;
}
.ajax_load img {
	margin:30px 0 0 180px;
}
</style>
</head>
<body>
<iframe name="frame" id="frame" style="display:none"></iframe>
<div id="TB_overlayBG"></div>
<div class="box" style="display:none" id="box">
  <h2>添加商家<a href="javascript:void(0);" class="close">关闭</a></h2>
  <div class="table-list">
    <table width="100%" border="0">
      <tbody>
        <tr>
          <td width="24%">商家用户ID:</td>
          <td width="76%"><input type="text" name="user_id" id="user_id" /></td>
        </tr>
		<tr>
          <td width="24%">服务类型:</td>
          <td width="76%">
		  <select name='type_id' id='type_id'>
		  <option value=''>请选择</option>
			<option value='12'>影棚租赁</option>
			<option value='3'>化妆服务</option>
			<option value='5'>摄影培训</option>
			<option value='31'>模特服务</option>
			<option value='40'>摄影服务</option>
		  </select>
		 </td>
        </tr>
        <tr>
          <td>可服务时间:</td>
          <td><input type="text" name="date_time" id="date_time" readonly="readonly" class="ui_timepicker" /></td>
        </tr>
        <tr>
          <td>价格:</td>
          <td><input type="text" name="price" id="price" /></td>
        </tr>
        <tr>
          <td>备注:</td>
          <td><textarea name="remark" id="remark" cols="45" rows="5"></textarea></td>
        </tr>
        <tr>
          <td colspan="2" align="center"><br />
            <input name="" type="button" value="添加" onclick="submit_recommend()" />
            <br /></td>
        </tr>
      <input type="hidden" name="order_id" id="order_id" value="{order_id}" />
        </tbody>
      
    </table>
  </div>
</div>

<div class="mainbox">
  <div id="tabs" style="margin-top:10px;">
    <div class="tabbox">
    
<!-- IF order.request_id -->
<div class="table-list">
        <div class="table" style="width:50%;">
          <fieldset>
            <legend>问卷</legend>
            <!--list-->
            <table  cellspacing="10" width="100%">
              <tbody>
                 <!-- BEGIN question.data -->              
                <tr>
                  <td >{titles}:</td>
                  <td >
                  <!-- BEGIN data -->
                  {titles}<br>
                  <!-- BEGIN data -->
                  &nbsp;&nbsp;->{titles}<br>
                  <!-- END data -->
                  <!-- END data -->
                  </td>                  
                </tr>                
                <!-- END question.data -->
                
              </tbody>
            </table>
          </fieldset>
        </div>
        <div class="table" style="width:50%;">
          
          <fieldset>
            <legend>用户信息</legend>
            <!--list-->
            <table  cellspacing="10" width="100%">
              <tbody>
                <tr>
                  <td width="179">用户昵称:</td>
                  <td width="1089">{order.cameraman_nickname}</td>
                </tr>
                <tr>
                  <td>联系电话:</td>
                  <td>{order.cameraman_phone}</td>
                </tr>
                 <tr>
                  <td>拍摄预算:</td>
                  <td>{order.budget}</td>
                </tr>
                 <tr>
                  <td>应收金额:</td>
                  <td>{order.receivable_amount}元</td>
                </tr>
               
                <tr>
                  <td>应付金额:</td>
                  <td>{order.payable_amount}元</td>
                </tr>
                 <tr>
                   <td>备注:</td>
                   <td>{order.date_remark}</td>
                </tr>
              </tbody>
            </table>
          </fieldset>
        </div>
      </div>
<!-- ELSE -->
      <div class="table-list">
        <div class="table" style="width:50%;">
          <fieldset>
            <legend>拍摄要求/价格</legend>
            <!--list-->
            <table  cellspacing="10" width="100%">
              <tbody>
                <tr>
                  <td width="150">主题风格:</td>
                  <td width="440">{order.style}</td>
                </tr>
                <tr>
                  <td>服装要求:</td>
                  <td>{order.clothes_require}</td>
                </tr>
                <tr>
                  <td>化妆/服装提供方:</td>
                  <td>{order.clothes_provide}</td>
                </tr>
                <tr>
                  <td>拍摄地点:</td>
                  <td>{order.city_name}</td>
                </tr>
                <tr>
                  <td>详细地址:</td>
                  <td>{order.date_address}</td>
                </tr>
                <tr>
                  <td>拍摄时间:</td>
                  <td>{order.date_time}</td>
                </tr>
                <tr>
                  <td>客户大概预算:</td>
                  <td>{order.about_budget}元</td>
                </tr>
                <tr>
                  <td>拍摄时长:</td>
                  <td>{order.hour}</td>
                </tr>
                <tr>
                  <td>数量:</td>
                  <td>{order.model_num}</td>
                </tr>
                <tr>
                  <td>拍摄预算:</td>
                  <td>{order.budget}</td>
                </tr>
              </tbody>
            </table>
          </fieldset>
        </div>
        <div class="table" style="width:50%;">
          <fieldset>
            <legend>用户信息</legend>
            <!--list-->
            <table  cellspacing="10" width="100%">
              <tbody>
                <tr>
                  <td width="179">用户昵称:</td>
                  <td width="1089">{order.cameraman_nickname}</td>
                </tr>
                <tr>
                  <td>联系电话:</td>
                  <td>{order.cameraman_phone}</td>
                </tr>
              </tbody>
            </table>
          </fieldset>
          <br />
          <br />
          <fieldset>
            <legend>模特要求</legend>
            <!--list-->
            <table  cellspacing="10" width="100%">
              <tbody>
                <tr>
                  <td width="179">三围要求:</td>
                  <td width="1089">{order.bwh_require}</td>
                </tr>
                <tr>
                  <td>身高要求:</td>
                  <td>{order.height_require}</td>
                </tr>
                <tr>
                  <td>体重要求:</td>
                  <td>{order.weight_require}</td>
                </tr>
                <tr>
                  <td>外貌要求:</td>
                  <td>{order.looks_require}</td>
                </tr>
                <tr>
                  <td>备注:</td>
                  <td>{order.date_remark}</td>
                </tr>
              </tbody>
            </table>
          </fieldset>
        </div>
      </div>
<!-- ENDIF -->      
    </div>

    
    
    <div class="table-list">
    
      <div class="btn">
        <input type="button" value="添加商家" class="button" id="add_model">
		<input type="button" value="返回" class="button" onclick="history.go(-1);">
      </div>
     
    </div>
    <span id="model_list"> 
    <!-- IF model_list -->
    
      <div class="table-list" style="margin-top:10px">
        <table width="100%" cellspacing="0">
          <thead>
            <tr>
              
              <th width="126">商家用户ID</th>
              <th width="156">商家昵称</th>
              <th width="243">可拍摄时间</th>
              <th width="243">拍摄价格</th>
              <th width="243">手机</th>
              <th width="257">备注</th>
              <th width="257">查看模特库</th>
              <th width="257">推荐时间</th>
              <th width="257">状态</th>
              <th width="257">操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- BEGIN model_list -->
            <tr>
              
              <td align="center">{user_id}</td>
              <td align="center">{nickname}</td>
              <td align="center">{date_time}</td>
              <td align="center">{price}</td>
              <td align="center">{cellphone}</td>
              <td align="center">{remark}</td>
              <td align="center"><a href="http://www.yueus.com/yue_admin/model_audit/model_detail.php?uid={user_id}" target="_blank">查看</a></td>
              <td align="center">{add_time}</td>
              <td align="center"><!-- IF status="0" -->待确认<!-- ELSEIF status="1" -->合适<!-- ELSEIF status="2" -->不合适<!-- ENDIF --></td>
              <td align="center"><!-- IF top.oa_role="operate" --><!-- IF status="0" --><a href="javascript:void(0);" onclick="update_recommend_status({id},{order_id},1)">合适</a>
              <a href="javascript:void(0);" onclick="update_recommend_status({id},{order_id},2)">不合适</a><!-- ENDIF -->
              
              <!-- IF status="1" --><a href="javascript:void(0);" onclick="update_recommend_status({id},{order_id},2)">不合适</a> <!-- ENDIF -->
              <!-- IF status="2" --> <a href="javascript:void(0);" onclick="update_recommend_status({id},{order_id},1)">合适</a><!-- ENDIF -->
              <!-- ENDIF -->
              
              <!-- IF top.oa_role="expand" -->
              <a href="javascript:void(0);" onclick="del_recommend({id},{order_id})">删除</a><!-- ENDIF -->
              </td>
              <!-- END model_list --> 
            </tr>
          </tbody>
        </table>
  </div>
      <div class="table-list">
      <!-- IF oa_role="expand" -->
        <div class="btn">
        <input type="button" value="返回" class="button" onclick="history.go(-1);">
         <input type="button" value="完成推荐" class="button" onclick="frame.location.href='model_match.php?order_id={order.order_id}&complete_recommend=1'">
     
        </div>
        <!-- ENDIF -->
        <!-- IF oa_role="operate" -->
        <div class="btn">
        <input type="button" value="返回" class="button" onclick="history.go(-1);">
        &nbsp;&nbsp;
        <input type="button" value="完成推荐" class="button" onclick="frame.location.href='model_match.php?order_id={order.order_id}&complete_recommend=1'">
          &nbsp;&nbsp;
         <input type="button" value="打回推荐" class="button" onclick="frame.location.href='model_match.php?order_id={order.order_id}&confirm_order=1'">
          
        &nbsp;&nbsp;
        <input type="button" value="通知摄影确认" class="button" onclick="frame.location.href='model_match.php?order_id={order.order_id}&shoot_confirm=1'">
        </div>
        <div class="btn">
      <form action="" method="post" target="frame">
      取消原因：<input type="text" size="30" name="cancel_reason" value=""  />
      <input type="hidden" name="order_id" value="{order.order_id}"  />
      <input type="hidden" name="cancel" value="1"  />
      <input type="submit" value="取消订单" class="button">
      </form>
       </div>
        
        <!-- ENDIF -->
      </div>
   
    <!-- ENDIF --> 
    </span> </div>
</div>
<script type="text/javascript">


$("#add_model").click(function(){
	$("#TB_overlayBG").css({
		display:"block",height:$(document).height()
	});
	$("#box").css({
		left:($("body").width()-$("#box").width())/2-20+"px",
		top:($(window).height()-$("#box").height())/10+$(window).scrollTop()+"px",
		display:"block"
	});
});

$(".close").click(function(){
	$("#TB_overlayBG").css("display","none");
	$("#box ").css("display","none");
});

function submit_recommend(){
	var order_id = $("#order_id").val();
	var user_id = $("#user_id").val();
	var type_id = $("#type_id").val();
	var price = $("#price").val();
	var date_time = $("#date_time").val();
	var remark = $("#remark").val();

	if(order_id==''){
		alert('订单ID不能为空');
		return false;	
	}
	if(user_id==''){
		alert('商家用户ID不能为空');
		return false;	
	}
	if(type_id==''){
		alert('请选择服务类别');
		return false;	
	}
	if(price==''){
		alert('价格不能为空');
		return false;	
	}
	if(date_time==''){
		alert('服务时间不能为空');
		return false;	
	}
	
	$.ajax({
			url: './module/submit_recommend.php',
			type: 'POST',
			data:{ order_id:order_id,user_id:user_id,price:price,date_time:date_time,remark:remark,type_id:type_id},
			timeout: 30000,
			error: function() { alert('Error loading data!'); },
			success: function(msg) {
				if(msg==1){			
					$("#TB_overlayBG").css("display","none");
					$("#box ").css("display","none");
					$("#user_id").val("");
					$("#price").val("");
					$("#date_time").val("");
					$("#remark").val("");		
					model_list(order_id);				
				}
				else if(msg==-1){
					alert('该商家已添加');
				}
				else if(msg==-2){
					alert('该ID不存在');
				}
				else if(msg==-3){
					alert('该ID不是商家');
				}
				else{
					alert('添加失败，请联系管理员');	
				}    
			}
	});	
}


function del_recommend(id,order_id){
	
	if(id==''){
		alert('ID不能为空');
		return false;	
	}
	
	if(order_id==''){
		alert('订单ID不能为空');
		return false;	
	}
	
	$.ajax({
			url: './module/del_recommend.php',
			type: 'POST',
			data:{ id:id},
			timeout: 30000,
			error: function() { alert('Error loading data!'); },
			success: function(msg) {
				if(msg==1){
					alert('删除成功');				
					model_list(order_id);				
				}else{
					alert('删除失败，请联系管理员');	
				}    
			}
	});	
}

function update_recommend_status(id,order_id,status){
	
	if(id==''){
		alert('ID不能为空');
		return false;	
	}
	
	
	$.ajax({
			url: './module/update_recommend.php',
			type: 'POST',
			data:{ id:id,status:status},
			timeout: 30000,
			error: function() { alert('Error loading data!'); },
			success: function(msg) {
				if(msg==1){		
					model_list(order_id);
					alert('操作成功');				
				}else{
					alert('操作失败，请联系管理员');	
				}    
			}
	});	
}

function model_list(order_id){
		$.ajax({
			url: './module/get_oa_model_list.php?order_id='+order_id,
			type: 'GET',
			timeout: 30000,
			error: function() { alert('Error loading data!'); },
			success: function(msg) {
				$("#model_list").html(msg);       
			}
		});
}


</script>
</body>
</html>