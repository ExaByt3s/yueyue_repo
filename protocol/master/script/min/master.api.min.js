$(function(){var TYPE_=$("select[name='type']"),CTY_=$("select[name='category']"),POST_=$("#post"),VS_=$("input[name='version']"),DUL_=$("ul.dropdown-menu");api_type=TYPE_.find("option:selected").val();$("#"+api_type).show();$("#"+(api_type==="customer"?"merchant":"customer")).hide();TYPE_.on("change",function(){var api_type=$(this).find("option:selected").val();$("#"+api_type).show();$("#"+(api_type==="customer"?"merchant":"customer")).hide()});$("input[name='search']").bind("input propertychange",function(){var search=$(this).val(),divider=0;var match=api.filter(function(e){if(e.indexOf(search)>0){return e}});if(match===[]||match.length<1){return}DUL_.show().empty();for(var i in match){var api_link=match[i];if(api_link.indexOf("customer/")>=0&&divider===0){DUL_.append('<li role="separator" class="divider"></li>');divider=1}var dli="<li>"+api_link+"</li>";DUL_.append(dli)}});DUL_.on("click","li",function(){var li=$(this).html();var type_="customer";if(li.indexOf("merchant/")>=0){var type_="merchant"}$("#"+type_).show();$("#"+(type_==="customer"?"merchant":"customer")).hide();TYPE_.find("option[value='"+type_+"']").attr("selected","selected");CTY_.find("option[value='"+li+"']").attr("selected","selected");VS_.attr("value",version[type_]);$("input[name='search']").attr("value",li);api_post_param(type_,li);DUL_.hide()}).on("mouseover","li",function(){$(this).addClass("li-over")}).on("mouseout","li",function(){$(this).removeClass("li-over")});VS_.attr("value",version["customer"]);TYPE_.on("change",function(){var api_type=TYPE_.find("option:selected").val();VS_.attr("value",version[api_type])});CTY_.on("change",function(){var api_type=TYPE_.find("option:selected").val();var api_path=$(this).find("option:selected").val();if(api_path===""||api_path===undefined){return false}api_post_param(api_type,api_path)});function api_post_param(api_type,api_path){if(api_type===""||api_path===""||api_type===undefined||api_path===undefined){return false}var api_post=postman[api_type][api_path];if(api_post===""||api_post===undefined){return false}$("input[name='path']").attr("value",api_path);var ldata=localData.getData(api_path);var islocal=0;POST_.html("<label>参数组装中...</label>");if(ldata!==null&&ldata!==undefined&&ldata!==""){islocal=1;var sjson=eval("("+ldata+")");if(sjson.postman!==undefined&&sjson.postman!==null){var json_postman=decodeURIComponent(sjson.postman);var re_=new RegExp(/\+/g);json_postman=json_postman.replace(re_," ");POST_.html('<textarea name="postman" class="form-control">'+json_postman+"</textarea>");return true}}if(typeof(api_post)==="string"){api_post=comfunc.jformat(api_post);POST_.html('<textarea name="postman" class="form-control">'+api_post+"</textarea>");return true}var key="",html="";for(key in api_post){var value=api_post[key];if(islocal===1){var local_val=sjson[key];if(local_val!==undefined&&local_val!==null){value=decodeURI(local_val)}}if(key==="user_id"){if(value===0||value===""||value==="0"){var user_id=parseInt($("input[name='user_id']").val());value=(user_id==="NaN"||isNaN(user_id))?0:user_id}}html+='<div class="input-group"><span class="input-group-addon">'+key+"</span>"+'<input type="text" class="form-control" name="'+key+'" value="'+value+'"></div>'}POST_.html(html);$("button.btn-primary").html("&nbsp;&nbsp;&nbsp;&nbsp;发&nbsp;&nbsp;送&nbsp;&nbsp;&nbsp;&nbsp;").removeAttr("disabled")}$("form.api-form").submit(function(e){e.preventDefault();$("#api-result").html("<span>API调试结果展示</span>");var path=$("input[name='path']").val();if(path===""||path===undefined||path===null||path.indexOf("/")<0){return false}var BTN_=$("button.btn-primary");BTN_.html("请求中").attr("disabled","disabled");var data=$(this).serialize();var re_=new RegExp("&","g"),re__=new RegExp("=","g");var sjson='{"'+data.replace(re_,'","').replace(re__,'":"')+'"}';localData.setData(path,sjson);$.post("#",data,function(D){BTN_.html("&nbsp;&nbsp;&nbsp;&nbsp;发&nbsp;&nbsp;送&nbsp;&nbsp;&nbsp;&nbsp;").removeAttr("disabled");if(D.code!==1){var msg=D.msg===undefined?"请求失败":D.msg;$("#api-result").html('<span class="error">'+msg+"</span>");return false}var contents=comfunc.jformat(D.data.contents);$("#api-result").html(contents)})}).ajaxComplete(function(){$("button.btn-primary").html("&nbsp;&nbsp;&nbsp;&nbsp;发&nbsp;&nbsp;送&nbsp;&nbsp;&nbsp;&nbsp;").removeAttr("disabled")});$("span.api-copy").click(function(){var data=$("#api-result").text();if(window.clipboardData){window.clipboardData.setData("Text",data);alert("复制成功！")}else{alert("暂不支持复制功能")}})});