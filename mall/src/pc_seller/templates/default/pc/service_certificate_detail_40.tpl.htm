<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>{page_title}</title>

    <!-- <link rel="import" href="./webcontrol/head.tpl.htm?__inline">
    -->
    <!-- 公共css，js引入 -->{pc_global_top}</head>

<body >

{global_top_bar}
<iframe id="form_iframe" name="form_iframe" style="display:none;"></iframe>
<form action="./module/pai_mall_certificate_service_op.php" method="post"  name="publish_form" id="publish_form" target="form_iframe">
    <div class="content">
        <div class="choose-type-page  w1000 font_wryh">
            <!--<div class="mod-choose-step-zone">
                <ul>
                    <li class="cur">
                        <i class="icon-radius ">1</i>
                        <a href="javascript:;" class="step-1" onclick="return false">选择类型</a>
                    </li>
                    <li class="cur">
                        <i class="icon-radius ">2</i>
                        <a href="javascript:;" class="step-2" onclick="return false">服务标准</a>
                    </li>
                    <li>
                        <i class="icon-radius ">3</i>
                        <a href="javascript:;" class="step-3" onclick="return false">开通</a>
                    </li>
                </ul>
            </div>-->
            <div class="mod-nav-item">
                <a href="./">约约商家主页</a>
                &gt;
                <a href="./normal_certificate_choose.php">认证中心</a>
                &gt;
                <a href="./normal_certificate_choose.php">品类认证</a>
                &gt;
                <span>{page_type_name}认证</span>
            </div>
            <div class="service-page mod-attest-page content-bg">
                <div class="mod-listItem">
                    <span>{page_type_name}认证</span>
                </div>
                <div class="form-warp" id="form-warp">
                    <div class="item">
                        <div class="mod-form-title">
                            <span>摄影年限</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-select-item photo-select-item">
                                <select name="years" class="font_wryh"  valid-rule="**1-100" valid-index='1'>
                                    <option value="">请选择</option>
                                    <!-- BEGIN certificate_common_years -->
                                    <option value="{value}">{value_name}</option>
                                    <!-- END certificate_common_years -->

                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>常用拍摄的器材</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-input-item">
                                <input tabindex="1" type="text" name="often_equipment" class="input-txt input-txt-1 font_wryh" placeholder="常用器材"  valid-rule="**1-100" valid-index='2'/>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>个人作品主页链接（POCO、豆瓣、网易、LOFTER、微博等）</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-input-item">
                                <input tabindex="2" type="text" name="zone_num" class="input-txt input-txt-1 font_wryh" placeholder="个人作品主页链接"  valid-rule="**1-1000" valid-index='3'/>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>微信账号</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-input-item">
                                <input tabindex="3" type="text" name="society_num[]" class="input-txt input-txt-1 font_wryh" placeholder="微信账号"  valid-rule="**1-100" valid-index='5'/>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>QQ账号</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-input-item">
                                <input tabindex="3" type="text" name="society_num[]" class="input-txt input-txt-1 font_wryh" placeholder="QQ账号"  valid-rule="**1-100" valid-index='8'/>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>个人/机构介绍</span><span style="color:#aaa;">（不超过400字）</span>
                        </div>
                        <div class="item-con">
                            <div class="textarea-item">
                                <textarea name="self_desc" class="textarea-txt font_wryh" placeholder=""   valid-rule="**1-400" valid-index='4' tabindex="4"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>每月交易额</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-select-item photo-select-item">
                                <select name="order_income" class="font_wryh"  valid-rule="**1-100" valid-index='6'>
                                    <option value="">请选择</option>
                                    <!-- BEGIN certificate_cameror_order_income -->
                                    <option value="{value}">{value_name}</option>
                                    <!-- END certificate_cameror_order_income -->

                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <div class="mod-form-title">
                            <span>团队构成</span>
                        </div>
                        <div class="item-con">
                            <div class="mod-select-item photo-select-item">
                                <select name="team" class="font_wryh"  valid-rule="**1-100" valid-index='7'>
                                    <option value="">请选择</option>
                                    <!-- BEGIN certificate_cameror_team -->
                                    <option value="{value}">{value_name}</option>
                                    <!-- END certificate_cameror_team -->

                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="add-works-item">
                        <div class="listItem">添加作品集进行认证：</div>
                        <div class="works-list">
                            <div class="works-item clearfix">
                                <h3 class="title">作品集类别：</h3>
                                <div class="works-item-con">
                                    <div class="mod-select-item photo-select-item">
                                        <select name="work_type_id[]" class="font_wryh"  valid-rule="**1-100" valid-index="100">
                                            <option value="">请选择</option>
                                            <!-- BEGIN certificate_cameror_work_type -->
                                            <option value="{value}">{value_name}</option>
                                            <!-- END certificate_cameror_work_type -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <!--<div class="works-item clearfix">
                                <h3 class="title">作品集名称：</h3>
                                <div class="works-item-con">
                                    <div class="mod-input-item">
                                        <input tabindex="5" type="text" name="work_name[]" class="input-txt input-txt-1 font_wryh" placeholder="请输入作品名称,长度不得超过30个汉字"  valid-rule="**1-30" valid-index="101"/>
                                    </div>
                                </div>
                            </div>

                            <div class="works-item clearfix">
                                <h3 class="title">作品描述：</h3>
                                <div class="works-item-con">
                                    <div class="textarea-item">
                                        <textarea tabindex="5" name="work_desc[]" class="textarea-txt font_wryh" placeholder="作品描述"  valid-rule="**1-10000" valid-index="103"></textarea>
                                    </div>
                                </div>
                            </div>-->
                            <div class="works-item clearfix">
                                <h3 class="title">作品上传：</h3>
                                <div class="works-item-con">
                                    <div class="upload-img-item">
                                        <div class="tips">
                                            （上传5到20张图片，能让工作人员更好的了解你。文件格式为jpg、jpeg、png，每张图片大小不超过3M）
                                        </div>
                                        <div class="ui-item clearfix J_upload-container_1" >

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="word_part[]" value="1" class="J_work_part">
                    <div class="add-works-btn" id="J_add_collection">
                        <a href="javascript:;" id="J_add_collection_btn" data-value="2">继续添加作品集</a>
                    </div>
                    <div class="btn-item">
                        <a href="javascript:;" class="ui-btn ui-btn-blue" id="J_form_submit" data-lock="unlock">提交审核</a>
                    </div>
                    <div style="text-align:center;color:#333;padding-top:10px;font-size:16px">等待审核过程中，可先发布服务</div>
                    <div style="text-align:center;color:#333;padding-top:10px;font-size:14px">若有问题，请联系客服4000-82-9003</div>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" value="{type_id}" name="type_id"/>

</form>
<input type="hidden" value="{user_id}" id="J_user_id">
{footer}

<script type="text/javascript" src="http://static.yueus.com/yue_ui/upload/1.0.0/webuploader.min.js"></script>
<script type="text/javascript">
// 头部
require('../../../modules/common/global-top-bar/global-top-bar');

require('../../../modules/common/layer/layer');

require('../../../modules/common/upload/1.0.0/yueyue_uploader');


// 表达验证类
var VA = require('../../../modules/common/valid/index');
// 设置容器
var valid = new VA($('#form-warp'));




//初始化第一个图片块
add_collection("J_upload-container_1","1");

//添加作品集
$("#J_add_collection_btn").on("click",function(){
    var part_id = $(this).attr("data-value");
    //构造结构
    var construct_html = construct_html_func(part_id);
    $("#J_add_collection").before(construct_html);
    //按钮的模块值自增
    var new_data_value = parseInt(part_id)+1;
    $("#J_add_collection_btn").attr("data-value",new_data_value);
    //初始化传图插件
    var ele_container = "J_upload-container_"+part_id;
    add_collection(ele_container,part_id);

    //容器内元素增减刷新容器
    valid.freshNodes($('#form-warp'));
    //刷新事件绑定
    fresh_bind();

})

function error_tips(ele,str)
{
    $("html,body").animate({scrollTop:ele.offset().top},300);
    layer.alert(str);
    return false;
}



fresh_bind();

function fresh_bind(){
    //绑定事件
    valid.pushfunctions
            ([
                {
                    index:'1',
                    ValidError : function(){
                        error_tips($("[valid-index='1']").parents(".item"),'请选择摄影年限');
                    }
                },
                {
                    index:'2',
                    ValidError : function(){
                        error_tips($("[valid-index='2']").parents(".item"),'请正确填入常用拍摄的器材');
                    }
                },
                {
                    index:'3',
                    ValidError : function(){
                        error_tips($("[valid-index='3']").parents(".item"), '请正确填入作品空间账号');
                    }
                },
                {
                    index:'4',
                    ValidError : function(){
                        error_tips($("[valid-index='4']").parents(".item"), '请正确填入个人/机构介绍，不超过四百字');
                    }
                },
                {
                    index:'5',
                    ValidError : function(){
                        error_tips($("[valid-index='5']").parents(".item"), '请正确填入微信账号');
                    }
                },
                {
                    index:'6',
                    ValidError : function(){
                        error_tips($("[valid-index='6']").parents(".item"), '请选择订单收入');
                    }
                },
                {
                    index:'7',
                    ValidError : function(){
                        error_tips($("[valid-index='7']").parents(".item"), '请正确团队构成');
                    }
                },
                {
                    index:'8',
                    ValidError : function(){
                        error_tips($("[valid-index='8']").parents(".item"), '请正确填入QQ账号');
                    }
                },
                {
                    index:'100',
                    ValidError : function(){

                        error_tips($(this).parents(".works-item-con"), '请选择作品集类别');
                    }
                }

            ]);
}

//提交form
$("#J_form_submit").on("click",function(){
    //获取验证结果
    var resault = valid.checkValid();
    //console.log(resault);

    if(resault.isPass)
    {

        //判断作品集块的图片
        var work_part_len = $(".J_work_part").length;
        var work_part_value = "";


        for(var i=0;i<work_part_len;i++)
        {
            work_part_value = $($(".J_work_part")[i]).val();
            //判断图片
            if(!$(".J_upload-container_"+work_part_value+" input").val())
            {
                error_tips($('.J_upload-container_'+work_part_value).parents(".works-item-con"), '请传入作品');
                return
            }

            //判断图片张数是否够5张
            if($(".J_upload-container_"+work_part_value+" input").val())
            {
                var img_len = $(".J_upload-container_"+work_part_value+" input").length;
                if(img_len<5)
                {
                    error_tips($('.J_upload-container_'+work_part_value).parents(".works-item-con"), '请传入大于等于5张作品图');
                    return
                }
            }
        }



        var data_lock = $(this).attr("data-lock");
        if(data_lock!="lock")
        {
            $(this).attr("data-lock","lock");//锁住
            layer.msg("正在提交中...");
            $("#publish_form").submit();
        }
        else
        {
            layer.msg("正在提交中...");
            return false;
        }
    }
})

//添加作品集
/*
 *ele_container:容器
 *part_id：模块标记值
 */
function add_collection(ele_container,part_id)
{
    $(function()
    {

        //todo 使用之前要确定userid是否传递进去
        var user_id = $("#J_user_id").val();
        var yue_upload_obj = new yue_upload_class
        ({
            upload_total_limit : 20,
            upload_container : $('.'+ele_container),
            user_id :  user_id,
            multiple : true,
            imgs : [],
            fileSizeLimit: 60 * 1024 * 1024,    // 200 M 总文件大小
            fileSingleSizeLimit: 3 * 1024 * 1024,    // 3 M 单文件大小
            gid : part_id
        });

        $('#popup_'+part_id).on('click', function()
        {
            var upload_obj ={};
            first_layer = layer.open
            ({
                type: 1,
                area: ['800px', '450px'],
                fix: false, //不固定
                title:'上传图片',
                maxmin: false,
                content: yue_upload_obj.tpl,
                success : function($el,index)
                {
                    var sec_layer = null;
                    var index = index;


                    setTimeout(function()
                    {
                        upload_obj = yue_upload_obj.init_upload($el);

                        upload_obj.on('uploadProgress',function()
                        {

                        })
                                .on('fileQueued',function(file)
                                {

                                })
                                .on('fileDequeued',function(file)
                                {

                                })
                                .on('uploadSuccess',function(file,response)
                                {
                                    // response 服务端返回数据
                                    //console.log(response);
                                })
                                .on('uploadError',function()
                                {

                                })
                                .on('uploadFinished',function()
                                {
                                    layer.close(index);
                                })
                    },500);
                },
                cancel : function()
                {
                    if(!confirm('注意！关闭弹窗会终止上传图片'))
                    {
                        return false;
                    }

                    upload_obj && upload_obj.stop(true);
                }
            });
        });
    });
}

//删除作品集
$("body").on("click",function(e){
    var target = e.target;
    var data_class = $(target).attr("data-class");
    if(data_class=="J_del_collection")
    {
        var data_mark = $(target).attr("data-mark");
        $("#J_collection_div_"+data_mark).remove();

        //容器内元素增减刷新容器
        valid.freshNodes($('#form-warp'));
        //刷新事件绑定
        fresh_bind();
    }



})



//构造html代码说
function construct_html_func(part_id)
{
    var construct_html = '<div class="add-works-item" id="J_collection_div_'+part_id+'">'+
            '<a href="javascript:;" class="fr" data-class="J_del_collection" style="color:red;" data-mark="'+part_id+'">'+
            '删除该作品集</a>'+
            '<div class="listItem">添加作品集进行认证：</div>'+
            '<div class="works-list">'+
            '<div class="works-item clearfix">'+
            '<h3 class="title">作品集类别：</h3>'+
            '<div class="works-item-con">'+
            '<div class="mod-select-item photo-select-item">'+
            '<select tabindex="5" name="work_type_id[]" class="font_wryh" valid-rule="**1-255" valid-index="100" >'+
            '<option value="">请选择</option>'+
        <!-- BEGIN certificate_cameror_work_type -->
            '<option value="{value}">{value_name}</option>'+
        <!-- END certificate_cameror_work_type -->
            '</select>'+
            '</div>'+
            '</div>'+
            '</div>'+
            '<div class="works-item clearfix">'+
            '<h3 class="title">作品上传：</h3>'+
            '<div class="works-item-con">'+
            '<div class="upload-img-item">'+
            '<div class="tips">'+
            '（上传5到20张图片，能让工作人员更好的了解你。文件格式为jpg、jpeg、png，每张图片大小不超过3M）'+
            '</div>'+
            '<div class="ui-item clearfix J_upload-container_'+part_id+'" >'+
            '</div>'+
            '</div>'+
            '</div>'+
            '</div>'+
            '<input type="hidden" value="'+part_id+'" name="word_part[]" class="J_work_part">'+
            '</div>'+
            '</div>';

    return construct_html;
}

</script>


</body>
</html>