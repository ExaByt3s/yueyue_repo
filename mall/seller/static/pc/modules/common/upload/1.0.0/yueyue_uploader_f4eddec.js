define("common/upload/1.0.0/yueyue_uploader",function(e){e("components/jquery/jquery.js"),e("common/json/json"),e("common/sortable/sortable");var i=e("common/cookie/index"),a=e("common/utility/index");if(/test/.test(window.location.href))var o="http://static.yueus.com/mall/seller/test/static/pc/modules/common/upload/1.0.0/yueyue_uploader.js".split("/");else var o="http://static-c.yueus.com/mall/seller/static/pc/modules/common/upload/1.0.0/yueyue_uploader.js".split("/");o.pop(),o=o.join("/"),function(e){var a=function(e,a){a=a||{};var t=a.params||{},l=0,n=0,s={poco_id:i.get("yue_member_id"),sh_type:"merchandise",role:"yueseller"};s=$.extend(!0,s,a.formData),s=JSON.stringify(s);var d={compress:!1,paste:"#uploader",swf:o+"/Uploader.swf",chunked:!1,chunkSize:524288,server:"http://sendmedia-w.yueus.com:8079/upload.cgi",auto:!1,cover_img:"",formData:{params:s},accept:{title:"Images",extensions:"jpg,jpeg,png",mimeTypes:"image/*"},fileVal:"opus",disableGlobalDnd:!0,fileNumLimit:20,fileSizeLimit:209715200,fileSingleSizeLimit:52428800};t=$.extend(!0,d,a);!function(){var e=new Image,i=!0;return e.onload=e.onerror=function(){(1!=this.width||1!=this.height)&&(i=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i}(),function(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(i){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(a){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}();WebUploader.Uploader.support()||alert("上传功能不支持您的IE浏览器！，请切换其他浏览器或者更新Flash");var r=WebUploader.create(t);return r.file_count=l,r.file_size=n,r.state="pedding",r.map_obj={},r.on("fileQueued",function(e){r.file_count++,r.file_size+=e.size,r.map_obj[e.id]=e}),r.on("fileDequeued",function(e){r.file_count--,r.file_size-=e.size,r.map_obj[e.id]&&delete r.map_obj[e.id]}),r.option("start_upload").$el.on("click",function(e){r.trigger("startUpload",e)}),r.get_file_by_id=function(e){return r.map_obj[e]||""},r.on("error",function(e){switch(e){case"Q_EXCEED_NUM_LIMIT":alert("上传文件数量超出上限了");break;case"Q_EXCEED_SIZE_LIMIT":alert("上传文件大小超出上限了");break;case"Q_TYPE_DENIED":alert("上传文件类型格式错误");break;case"F_EXCEED_SIZE":alert("上传文件大小超出上限了")}}),r};e.yueyue_uploader=a}(window),function(e,i){e.yue_upload_class=function(e){this.init(e)},yue_upload_class.prototype={init:function(e){var i=this;return i.options=e||{},i.options.gid?i.options.user_id?void i.init_img_group():void alert("缺少用户ID！"):void alert("必须传入图片组ID！")},tpl:'<div class="ui-item"><div class="upload-page-content" data-role="first-page" ><div id="first_file_picker" class="choose-img-btn" data-role="choose-img-btn">选择图片</div><div class="upload-img-btn" ></div><p>按住Ctrl可多选图片</p></div><div class="webuploader-element-invisible" data-role="sec-page" id="go-on-add-page"><div class="upload-page-content" style="padding: 10px 0 0 10px;" ></div><div class="upload-start-continue"><a class="upload-start upload-btn" id="start-upload-btn" href="javascript:void(0);">开始上传</a><div style="display: inline-block;margin-left:10px;" id="page-show" data-role="go-on-add-btn" >继续添加</div><div class="upload-img-btn2"></div><span class="upload-tips" data-role="upload-tips"></span></div></div></div>',init_img_group:function(){var e=this,i=e.options,a=i.upload_container||!1,o=i.imgs||[];e.add_item_img_obj={},e.upload_total_limit=i.upload_total_limit||9,e.add_item_img_obj=e.add_item_img(a,{imgs:o})},add_item_img:function(e,o){function t(){if(e.length){var i=e.find('[data-role="add-btn"]');e.find('[data-role="add-btn"]').length?e.find('[data-role="ui-success-upload-img"] img').length>=s?i.addClass("webuploader-element-invisible"):i.removeClass("webuploader-element-invisible"):e.find('[data-role="ui-success-upload-img"] img').length<s?i.removeClass("webuploader-element-invisible"):i.addClass("webuploader-element-invisible")}}var l=this,n=o.imgs||[],s=l.upload_total_limit,d=[],r="width: 130px;height: 130px;",u="";if("front"==l.options.upload_logic_key&&(r="height: 130px;",u="front"),l.options.upload_container){var p='<div class="ui-btn-add ui-btn disable-drag" data-role="add-btn"><a href="javascript:void(0);" class="ui-bf" title="添加图片" id="popup_'+l.options.gid+'"></a></div>';if(n.length>0)for(var c=0;c<n.length;c++){var m=n[c];"front"==l.options.upload_logic_key&&(m=a.matching_img_size(m,320));var f='<div class="ui-upload ui-btn bg-color" data-role="ui-success-upload-img"  ><a  class="'+u+'" href="javascript:;">   <img style="'+r+'" src="'+m+'" title=""/>   <input type="hidden" name="yue_upload_group_'+l.options.gid+'[]" value="'+m+'" /></a><div class="ui-upload-shadow"><a class="close-img"></a></div></div>';d[c]=f}e.length&&!e.find('[data-role="add-btn"]').length&&d.push(p);var g=i(d.join(""));e.length&&(e.children().length?e.find('[data-role="add-btn"]').before(g):e.append(g)),e.length&&e.find('[data-role="ui-success-upload-img"]').hover(function(){i(this).addClass("show")},function(){i(this).removeClass("show")}),g.find(".close-img").on("click",function(e){var a=i(e.currentTarget),o=a.parents(".ui-btn");o.remove(),t()}),t()}return l.init_sortable(),{get_cur_img_list:function(){for(var i=e.length&&e.find('[data-role="ui-success-upload-img"] img')||[],a=[],o=0;o<i.length;o++)a[o]=i.eq(o).attr("src");return a},refresh:function(){}}},init_sortable:function(){var e=this;e.options.sortable&&(e.options.upload_container.sortable({items:"div:not(.disable-drag)",cancel:".ui-upload-shadow",activate:function(e,i){console.log(i)}}).bind(function(i){e.options.sortable_callback&&e.options.sortable_callback.call(this,i)}),e.options.upload_container.disableSelection())},init_upload:function(e){function a(e,i){var a,o="",t=l.file_count,n=l.file_size;"ready"===e?o="选中"+l.file_count+"张图片，共"+WebUploader.formatSize(n)+"。":"confirm"===e?(a=l.getStats(),a.uploadFailNum&&(o="已成功上传"+a.successNum+"张照片至相册，"+a.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>')):(a=l.getStats(),o="共"+t+"张（"+WebUploader.formatSize(n)+"），已上传"+a.successNum+"张",a.uploadFailNum&&(o+="，失败"+a.uploadFailNum+"张")),i.html(o)}var o=this,t=o.options,l=null,n=o.tpl,s=function(e){var a='<div class="ui-upload ui-btn bg-color" data-file-id="'+e.id+'" id="upload-img-"'+e.id+'><a href="javascript:void(0);" class="">   <img src="'+e.url+'" title=""/><div class="ui-upload-progress" style="display: none;" data-role="progress">上传中...</div></a><div class="ui-upload-shadow"><a  class="close-img"></a></div></div>',o=i(a);return o.hover(function(){"none"==o.find('[data-role="progress"]').css("display")&&i(this).addClass("show")},function(){i(this).removeClass("show")}),o.find(".close-img").on("click",function(e){var a=i(e.currentTarget),o=a.parents("[data-file-id]"),t=o.attr("data-file-id"),n=l.get_file_by_id(t);l.removeFile(n),o.remove()}),o},d=i(n),r=e.find('[data-role="first-page"]'),u=e.find('[data-role="sec-page"]'),p=u.find(".upload-page-content"),c=u.find('[data-role="upload-tips"]'),m=o.upload_total_limit-o.add_item_img_obj.get_cur_img_list().length;o.options.multiple||(m=1);var f={auto:!1,fileNumLimit:m,pick:{id:"#first_file_picker",label:"选择图片"},start_upload:{$el:u.find("#start-upload-btn")},formData:o.options.form_data};f=i.extend(!0,f,o.options),l=yueyue_uploader(d.find("#upload-wrapper"),f),l.imgs=[];var g=130,_=130;return l.on("startUpload",function(){"uploading"!=l.state&&l.upload()}),t.upload_total_limit>1&&l.addButton({id:'[data-role="go-on-add-btn"]',label:"继续添加"}),l.on("fileQueued",function(e){console.log(e),l.file_count>=1&&(r.addClass("webuploader-element-invisible"),u.removeClass("webuploader-element-invisible"),l.refresh(),l.state="ready",a(l.state,c),l.makeThumb(e,function(i,a){if(!i){console.log(a);var o=s({id:e.id,url:a});p.append(o)}},g,_))}),l.on("fileDequeued",function(){l.file_count||(l.state="pedding",r.removeClass("webuploader-element-invisible"),u.addClass("webuploader-element-invisible"),l.refresh()),a(l.state,c),console.log("remove file")}),l.on("uploadStart",function(e){var a=e.id,o=i('[data-file-id="'+a+'"]');o.find('[data-role="progress"]').show()}),l.on("uploadProgress",function(e,a){console.log(a);var o=e.id,t=i('[data-file-id="'+o+'"]'),a=parseInt(100*a,10);t.find('[data-role="progress"]').html(a+"%")}),l.on("uploadSuccess",function(e,a){if(console.log(a),a.url instanceof Array)var o=a.url[0]||"";else var o=a.url||"";var t=e.id,n=i('[data-file-id="'+t+'"]');n.find('[data-role="progress"]').text("已完成"),l.imgs.push(o)}),l.on("uploadError",function(){l.imgs=[]}),l.on("uploadComplete",function(){}),l.on("uploadFinished",function(){alert("上传成功"),o.options.upload_container&&(o.add_item_img_obj=o.add_item_img(o.options.upload_container,{imgs:l.imgs}))}),l.on("all",function(e){switch(e){case"uploadFinished":case"uploadError":l.state="confirm",i('[data-role="go-on-add-btn"]').removeClass("webuploader-element-invisible ");break;case"startUpload":l.state="uploading",i('[data-role="go-on-add-btn"]').addClass("webuploader-element-invisible ");break;case"stopUpload":l.state="paused"}}),l}}}(window,$)});