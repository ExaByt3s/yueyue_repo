define("common/upload/1.0.0/yueyue_uploader",function(e){e("components/jquery/jquery.js"),e("common/json/json"),e("common/sortable/sortable");var a=e("common/cookie/index");if(/test/.test(window.location.href))var i="http://static.yueus.com/mall/seller/test/static/pc/modules/common/upload/1.0.0/yueyue_uploader.js".split("/");else var i="http://static-c.yueus.com/mall/seller/static/pc/modules/common/upload/1.0.0/yueyue_uploader.js".split("/");i.pop(),i=i.join("/"),function(e){var o=function(e,o){o=o||{};var t=o.params||{},l=0,n=0,s={poco_id:a.get("yue_member_id"),sh_type:"merchandise"};s=$.extend(!0,s,o.formData),s=JSON.stringify(s);var d={paste:"#uploader",swf:i+"/Uploader.swf",chunked:!1,chunkSize:524288,server:"http://sendmedia.yueus.com:8079/upload.cgi",auto:!1,cover_img:"",formData:{params:s},accept:{title:"Images",extensions:"jpg,jpeg,png",mimeTypes:"image/*"},fileVal:"opus",disableGlobalDnd:!0,fileNumLimit:20,fileSizeLimit:209715200,fileSingleSizeLimit:52428800};t=$.extend(!0,d,o);!function(){var e=new Image,a=!0;return e.onload=e.onerror=function(){(1!=this.width||1!=this.height)&&(a=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a}(),function(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(a){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}();WebUploader.Uploader.support()||alert("上传功能不支持您的IE浏览器！，请切换其他浏览器或者更新Flash");var r=WebUploader.create(t);return r.file_count=l,r.file_size=n,r.state="pedding",r.map_obj={},r.on("fileQueued",function(e){r.file_count++,r.file_size+=e.size,r.map_obj[e.id]=e}),r.on("fileDequeued",function(e){r.file_count--,r.file_size-=e.size,r.map_obj[e.id]&&delete r.map_obj[e.id]}),r.option("start_upload").$el.on("click",function(e){r.trigger("startUpload",e)}),r.get_file_by_id=function(e){return r.map_obj[e]||""},r.on("error",function(e){switch(e){case"Q_EXCEED_NUM_LIMIT":alert("上传文件数量超出上限了");break;case"Q_EXCEED_SIZE_LIMIT":alert("上传文件大小超出上限了");break;case"Q_TYPE_DENIED":alert("上传文件类型格式错误");break;case"F_EXCEED_SIZE":alert("上传文件大小超出上限了")}}),r};e.yueyue_uploader=o}(window),function(e,a){e.yue_upload_class=function(e){this.init(e)},yue_upload_class.prototype={init:function(e){var a=this;return a.options=e||{},a.options.gid?a.options.user_id?void a.init_img_group():void alert("缺少用户ID！"):void alert("必须传入图片组ID！")},tpl:'<div class="ui-item"><div class="upload-page-content" data-role="first-page" ><div id="first_file_picker" class="choose-img-btn" data-role="choose-img-btn">选择图片</div><div class="upload-img-btn" ></div><p>按住Ctrl可多选图片</p></div><div class="webuploader-element-invisible" data-role="sec-page" id="go-on-add-page"><div class="upload-page-content" style="padding: 10px 0 0 10px;" ></div><div class="upload-start-continue"><a class="upload-start upload-btn" id="start-upload-btn" href="javascript:void(0);">开始上传</a><div style="display: inline-block;margin-left:10px;" id="page-show" data-role="go-on-add-btn" >继续添加</div><div class="upload-img-btn2"></div><span class="upload-tips" data-role="upload-tips"></span></div></div></div>',init_img_group:function(){var e=this,a=e.options,i=a.upload_container||!1,o=a.imgs||[];e.add_item_img_obj={},e.upload_total_limit=a.upload_total_limit||9,e.add_item_img_obj=e.add_item_img(i,{imgs:o})},add_item_img:function(e,i){function o(){if(e.length){var a=e.find('[data-role="add-btn"]');e.find('[data-role="add-btn"]').length?e.find('[data-role="ui-success-upload-img"] img').length>=n?a.addClass("webuploader-element-invisible"):a.removeClass("webuploader-element-invisible"):e.find('[data-role="ui-success-upload-img"] img').length<n?a.removeClass("webuploader-element-invisible"):a.addClass("webuploader-element-invisible")}}var t=this,l=i.imgs||[],n=t.upload_total_limit,s=[];if(t.options.upload_container){var d='<div class="ui-btn-add ui-btn disable-drag" data-role="add-btn"><a href="javascript:void(0);" class="ui-bf" title="添加图片" id="popup_'+t.options.gid+'"></a></div>';if(l.length>0)for(var r=0;r<l.length;r++){var u=l[r],p='<div class="ui-upload ui-btn bg-color" data-role="ui-success-upload-img"  ><a  class="">   <img style="width: 130px;height: 130px;" src="'+u+'" title=""/>   <input type="hidden" name="yue_upload_group_'+t.options.gid+'[]" value="'+u+'" /></a><div class="ui-upload-shadow"><a class="close-img"></a></div></div>';s[r]=p}e.length&&!e.find('[data-role="add-btn"]').length&&s.push(d);var c=a(s.join(""));e.length&&(e.children().length?e.find('[data-role="add-btn"]').before(c):e.append(c)),e.length&&e.find('[data-role="ui-success-upload-img"]').hover(function(){a(this).addClass("show")},function(){a(this).removeClass("show")}),c.find(".close-img").on("click",function(e){var i=a(e.currentTarget),t=i.parents(".ui-btn");t.remove(),o()}),o()}return t.init_sortable(),{get_cur_img_list:function(){for(var a=e.length&&e.find('[data-role="ui-success-upload-img"] img')||[],i=[],o=0;o<a.length;o++)i[o]=a.eq(o).attr("src");return i},refresh:function(){}}},init_sortable:function(){var e=this;e.options.sortable&&(e.options.upload_container.sortable({items:"div:not(.disable-drag)",cancel:".ui-upload-shadow",activate:function(e,a){console.log(a)}}).bind(function(a){e.options.sortable_callback&&e.options.sortable_callback.call(this,a)}),e.options.upload_container.disableSelection())},init_upload:function(e){function i(e,a){var i,o="",t=l.file_count,n=l.file_size;"ready"===e?o="选中"+l.file_count+"张图片，共"+WebUploader.formatSize(n)+"。":"confirm"===e?(i=l.getStats(),i.uploadFailNum&&(o="已成功上传"+i.successNum+"张照片至相册，"+i.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>')):(i=l.getStats(),o="共"+t+"张（"+WebUploader.formatSize(n)+"），已上传"+i.successNum+"张",i.uploadFailNum&&(o+="，失败"+i.uploadFailNum+"张")),a.html(o)}var o=this,t=o.options,l=null,n=o.tpl,s=function(e){var i='<div class="ui-upload ui-btn bg-color" data-file-id="'+e.id+'" id="upload-img-"'+e.id+'><a href="javascript:void(0);" class="">   <img src="'+e.url+'" title=""/><div class="ui-upload-progress" style="display: none;" data-role="progress">上传中...</div></a><div class="ui-upload-shadow"><a  class="close-img"></a></div></div>',o=a(i);return o.hover(function(){"none"==o.find('[data-role="progress"]').css("display")&&a(this).addClass("show")},function(){a(this).removeClass("show")}),o.find(".close-img").on("click",function(e){var i=a(e.currentTarget),o=i.parents("[data-file-id]"),t=o.attr("data-file-id"),n=l.get_file_by_id(t);l.removeFile(n),o.remove()}),o},d=a(n),r=e.find('[data-role="first-page"]'),u=e.find('[data-role="sec-page"]'),p=u.find(".upload-page-content"),c=u.find('[data-role="upload-tips"]'),m=o.upload_total_limit-o.add_item_img_obj.get_cur_img_list().length;o.options.multiple||(m=1);var f={auto:!1,fileNumLimit:m,pick:{id:"#first_file_picker",label:"选择图片"},start_upload:{$el:u.find("#start-upload-btn")},formData:o.options.form_data};f=a.extend(!0,f,o.options),l=yueyue_uploader(d.find("#upload-wrapper"),f),l.imgs=[];var g=130,_=130;return l.on("startUpload",function(){"uploading"!=l.state&&l.upload()}),t.upload_total_limit>1&&l.addButton({id:'[data-role="go-on-add-btn"]',label:"继续添加"}),l.on("fileQueued",function(e){console.log(e),l.file_count>=1&&(r.addClass("webuploader-element-invisible"),u.removeClass("webuploader-element-invisible"),l.refresh(),l.state="ready",i(l.state,c),l.makeThumb(e,function(a,i){if(!a){console.log(i);var o=s({id:e.id,url:i});p.append(o)}},g,_))}),l.on("fileDequeued",function(){l.file_count||(l.state="pedding",r.removeClass("webuploader-element-invisible"),u.addClass("webuploader-element-invisible"),l.refresh()),i(l.state,c),console.log("remove file")}),l.on("uploadStart",function(e){var i=e.id,o=a('[data-file-id="'+i+'"]');o.find('[data-role="progress"]').show()}),l.on("uploadProgress",function(e,a){console.log(a)}),l.on("uploadSuccess",function(e,i){if(console.log(i),i.url instanceof Array)var o=i.url[0]||"";else var o=i.url||"";var t=e.id,n=a('[data-file-id="'+t+'"]');n.find('[data-role="progress"]').text("已完成"),l.imgs.push(o)}),l.on("uploadError",function(){l.imgs=[]}),l.on("uploadComplete",function(){}),l.on("uploadFinished",function(){alert("上传成功"),o.options.upload_container&&(o.add_item_img_obj=o.add_item_img(o.options.upload_container,{imgs:l.imgs}))}),l.on("all",function(e){switch(e){case"uploadFinished":case"uploadError":l.state="confirm",a('[data-role="go-on-add-btn"]').removeClass("webuploader-element-invisible ");break;case"startUpload":l.state="uploading",a('[data-role="go-on-add-btn"]').addClass("webuploader-element-invisible ");break;case"stopUpload":l.state="paused"}}),l}}}(window,$)});