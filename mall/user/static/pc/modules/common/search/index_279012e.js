define("common/search/index",function(require,exports,module){function change_url_params(url,name,value){var url=url,newUrl="",reg=new RegExp("(^|)"+name+"=([^&]*)(|$)"),tmp=name+"="+value;return newUrl=null!=url.match(reg)?url.replace(eval(reg),tmp):url.match("[?]")?url+"&"+tmp:url+"?"+tmp}var search_tpl=Handlebars.template(function(a,t,e,n,r){function l(){return' \n			    onchange="submit_by_select()"\n			    '}function i(){return"selected"}function s(a,t,n){var r,l,i,s="";return s+='\n                <div class="search-text fldi " style="',r=e.unless.call(a,a&&a.show,{hash:{},inverse:g.noop,fn:g.program(6,o,t),data:t}),(r||0===r)&&(s+=r),s+='" data-role="',(l=e.search_type)?r=l.call(a,{hash:{},data:t}):(l=a&&a.search_type,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+'-input-container">\n                    <input ',r=e.unless.call(a,a&&a.show,{hash:{},inverse:g.noop,fn:g.program(8,c,t),data:t}),(r||0===r)&&(s+=r),s+=' value="',(l=e.text)?r=l.call(a,{hash:{},data:t}):(l=a&&a.text,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+'" data-placeholder="',(l=e.place_holder)?r=l.call(a,{hash:{},data:t}):(l=a&&a.place_holder,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+'" data-role="search_text" class="text font_wryh" name="keywords" autocomplete="off" maxlength="255" accesskey="s" id="search-text"\n                    ',l=e.if_equal||a&&a.if_equal,i={hash:{},inverse:g.program(12,h,t),fn:g.program(10,d,t),data:t},r=l?l.call(a,a&&a.search_type,"goods",i):x.call(a,"if_equal",a&&a.search_type,"goods",i),(r||0===r)&&(s+=r),s+=" />\n                    <input ",r=e.unless.call(a,a&&a.show,{hash:{},inverse:g.noop,fn:g.program(8,c,t),data:t}),(r||0===r)&&(s+=r),s+=' value="',(l=e.default_text)?r=l.call(a,{hash:{},data:t}):(l=a&&a.default_text,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+'" name="default_text" type="hidden" data-role="default-search-text">\n                    <input ',r=e.unless.call(a,a&&a.show,{hash:{},inverse:g.noop,fn:g.program(8,c,t),data:t}),(r||0===r)&&(s+=r),s+=' value="',(l=e.default_url)?r=l.call(a,{hash:{},data:t}):(l=a&&a.default_url,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+'" name="default_url" type="hidden" data-role="default-url">\n                    <button class="icon-search" style="background-image:url(\''+$((r=n&&n.icon_search,typeof r===b?r.apply(a):r))+'\')" data-role="search-go" type="submit"></button>\n                    <input ',r=e.unless.call(a,a&&a.show,{hash:{},inverse:g.noop,fn:g.program(8,c,t),data:t}),(r||0===r)&&(s+=r),s+=' type="hidden" name="type_id" value="',(l=e.type_id)?r=l.call(a,{hash:{},data:t}):(l=a&&a.type_id,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+'">\n                    <label style="',r=e["if"].call(a,a&&a.text,{hash:{},inverse:g.noop,fn:g.program(14,p,t),data:t}),(r||0===r)&&(s+=r),s+='"  data-role="label-place-holder" class="label-place-holder">',(l=e.place_holder)?r=l.call(a,{hash:{},data:t}):(l=a&&a.place_holder,r=typeof l===b?l.call(a,{hash:{},data:t}):l),s+=$(r)+"</label>\n\n                </div>\n            "}function o(){return"display:none;"}function c(){return"disabled"}function d(){return'title="请输入关键字"'}function h(){return'title="请输入商家ID/商家名称"'}function p(){return"visibility: hidden;display: none;"}function f(a,t){var n,r="";return r+='\n	<div class="search-hot-tag fldi">\n		\n		<span>热门搜索：</span>\n		',n=e.each.call(a,a&&a.hot_data,{hash:{},inverse:g.noop,fn:g.program(17,u,t),data:t}),(n||0===n)&&(r+=n),r+="		\n	</div>\n	"}function u(a,t){var n,r,l="";return l+='\n		<span class="pr5 pl5"><a href="',(r=e.link)?n=r.call(a,{hash:{},data:t}):(r=a&&a.link,n=typeof r===b?r.call(a,{hash:{},data:t}):r),l+=$(n)+'" title="',(r=e.title)?n=r.call(a,{hash:{},data:t}):(r=a&&a.title,n=typeof r===b?r.call(a,{hash:{},data:t}):r),l+=$(n)+'">',(r=e.str)?n=r.call(a,{hash:{},data:t}):(r=a&&a.str,n=typeof r===b?r.call(a,{hash:{},data:t}):r),l+=$(n)+"</a></span>\n		"}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),r=r||{};var _,v,m,y="",g=this,b="function",$=this.escapeExpression,x=e.helperMissing;return y+='<div class="search-mod clearfix ">\n	<div class="search-form-container fldi " >\n		<form method="GET" action="',(v=e.search_url)?_=v.call(t,{hash:{},data:r}):(v=t&&t.search_url,_=typeof v===b?v.call(t,{hash:{},data:r}):v),y+=$(_)+'" id="search-form">\n		    <div class="search-left fldi">\n			    <select data-role="search_service_type" name="search_type" \n			    ',_=e["if"].call(t,t&&t.select_use_change,{hash:{},inverse:g.noop,fn:g.program(1,l,r),data:r}),(_||0===_)&&(y+=_),y+='\n			    >\n			    	<option value="goods" ',v=e.if_equal||t&&t.if_equal,m={hash:{},inverse:g.noop,fn:g.program(3,i,r),data:r},_=v?v.call(t,t&&t.search_type,"goods",m):x.call(t,"if_equal",t&&t.search_type,"goods",m),(_||0===_)&&(y+=_),y+='>服务</option>\n			    	<option value="seller" ',v=e.if_equal||t&&t.if_equal,m={hash:{},inverse:g.noop,fn:g.program(3,i,r),data:r},_=v?v.call(t,t&&t.search_type,"seller",m):x.call(t,"if_equal",t&&t.search_type,"seller",m),(_||0===_)&&(y+=_),y+=">商家</option>\n			    </select>			    \n		    </div>\n		    ",_=e.each.call(t,t&&t.data,{hash:{},inverse:g.noop,fn:g.programWithDepth(5,s,r,t),data:r}),(_||0===_)&&(y+=_),y+='\n            <input type="hidden" value="1" name="p">\n	    </form>\n	</div>\n	',_=e["if"].call(t,t&&t.hot_data,{hash:{},inverse:g.noop,fn:g.program(16,f,r),data:r}),(_||0===_)&&(y+=_),y+="\n</div>\n<script>\n	// 下拉提交\n	function submit_by_select()\n	{\n		var doc = document;\n		doc.getElementById('search-text').value = '';\n		doc.getElementById('search-form').submit();\n	}\n\n\n</script>"}),filter_tpl=Handlebars.template(function(a,t,e,n,r){function l(){return"radius-4px"}function i(a,t){var n,r,l="";return l+='\n	            <li class="fldi"><a href="',(r=e.link)?n=r.call(a,{hash:{},data:t}):(r=a&&a.link,n=typeof r===f?r.call(a,{hash:{},data:t}):r),l+=u(n)+'#dw" ',n=e["if"].call(a,a&&a.selected,{hash:{},inverse:_.noop,fn:_.program(4,s,t),data:t}),(n||0===n)&&(l+=n),l+=">",(r=e.name)?n=r.call(a,{hash:{},data:t}):(r=a&&a.name,n=typeof r===f?r.call(a,{hash:{},data:t}):r),l+=u(n)+"</a></li>\n	        "}function s(){return'class="a-selected" '}function o(a,t){var n,r="";return r+='\n	<div class="search-filter-body " data-role="search-filter-body">\n		',n=e.each.call(a,a&&a.filter_data,{hash:{},inverse:_.noop,fn:_.program(7,c,t),data:t}),(n||0===n)&&(r+=n),r+="	\n	</div>\n	"}function c(a,t){var n,r,l="";return l+='\n		<div data-role-key-name="',(r=e.name)?n=r.call(a,{hash:{},data:t}):(r=a&&a.name,n=typeof r===f?r.call(a,{hash:{},data:t}):r),l+=u(n)+'" class="clearfix search-filter-item" data-role="search-filter-list">\n		    <div class="search-filter-body-name fldi" >',(r=e.text)?n=r.call(a,{hash:{},data:t}):(r=a&&a.text,n=typeof r===f?r.call(a,{hash:{},data:t}):r),l+=u(n)+'：</div>		   \n		    <ul class="search-filter-body-con fldi clearfix" >\n		        ',n=e.each.call(a,a&&a.data,{hash:{},inverse:_.noop,fn:_.program(8,d,t),data:t}),(n||0===n)&&(l+=n),l+='\n		    </ul>\n		    <a href="javascript:;" class="more fn-hide"><span><i class="arrow bottom"><s>◇</s></i><em>展开</em></span></a>\n		</div>\n		'}function d(a,t){var n,r,l="";return l+='\n		            <li  data-role="search-filter-list-items" class="fldi"><a ',n=e["if"].call(a,a&&a.selected,{hash:{},inverse:_.noop,fn:_.program(4,s,t),data:t}),(n||0===n)&&(l+=n),l+=' href="',(r=e.link)?n=r.call(a,{hash:{},data:t}):(r=a&&a.link,n=typeof r===f?r.call(a,{hash:{},data:t}):r),l+=u(n)+'#dw">',(r=e.val)?n=r.call(a,{hash:{},data:t}):(r=a&&a.val,n=typeof r===f?r.call(a,{hash:{},data:t}):r),l+=u(n)+"</a></li>\n		        "}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),r=r||{};var h,p="",f="function",u=this.escapeExpression,_=this;return p+='<div>\n	<div class="search-filter-header clearfix ',h=e.unless.call(t,t&&t.filter_data,{hash:{},inverse:_.noop,fn:_.program(1,l,r),data:r}),(h||0===h)&&(p+=h),p+='">\n	    <div class="search-filter-header-name fldi">品类：</div>	    \n	    <ul class="search-filter-header-con fldi clearfix">\n	        ',h=e.each.call(t,t&&t.type_data,{hash:{},inverse:_.noop,fn:_.program(3,i,r),data:r}),(h||0===h)&&(p+=h),p+="\n	    </ul>\n	</div>\n	",h=e["if"].call(t,t&&t.filter_data,{hash:{},inverse:_.noop,fn:_.program(6,o,r),data:r}),(h||0===h)&&(p+=h),p+="\n</div>\n"}),sort_tpl=Handlebars.template(function(a,t,e,n,r){function l(a,t){var n,r,l="";return l+='\r\n    <p data-res="" class="data_res"><i class="icon-tips mr10" style="background-image:url(\'',(r=e.icon_tips)?n=r.call(a,{hash:{},data:t}):(r=a&&a.icon_tips,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+"');\"></i>",(r=e.no_data_text)?n=r.call(a,{hash:{},data:t}):(r=a&&a.no_data_text,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+"</p>\r\n    "}function i(a,t){var n,r,l="";return l+='      \r\n    <p data-res="" class="data_res">搜索到 ',(r=e.keywords)?n=r.call(a,{hash:{},data:t}):(r=a&&a.keywords,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+" ",n=e["if"].call(a,a&&a.is_seller,{hash:{},inverse:y.program(6,o,t),fn:y.program(4,s,t),data:t}),(n||0===n)&&(l+=n),l+=" ",(r=e.total)?n=r.call(a,{hash:{},data:t}):(r=a&&a.total,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+" 个</p>\r\n    "}function s(){return"商家"}function o(){return"服务"}function c(a,t){var n,r="";return r+='\r\n<div class="w1000" data-role="achor-sort-btn" >\r\n    ',n=e["if"].call(a,a&&a.is_seller,{hash:{},inverse:y.program(13,f,t),fn:y.program(9,d,t),data:t}),(n||0===n)&&(r+=n),r+="\r\n\r\n</div>\r\n"}function d(a,t){var n,r="";return r+=' \r\n    <ul class="search-order clearfix">        \r\n        ',n=e.each.call(a,a&&a.sort_btn,{hash:{},inverse:y.noop,fn:y.program(10,h,t),data:t}),(n||0===n)&&(r+=n),r+="\r\n        \r\n    </ul>\r\n    "}function h(a,t){var n,r,l="";return l+='\r\n        <li class="fldi ',n=e["if"].call(a,a&&a.selected,{hash:{},inverse:y.noop,fn:y.program(11,p,t),data:t}),(n||0===n)&&(l+=n),l+='">\r\n        <a class="db" href="javacript:;" data-sort-arr="',(r=e.sort)?n=r.call(a,{hash:{},data:t}):(r=a&&a.sort,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+'" data-orderby="',(r=e.orderby)?n=r.call(a,{hash:{},data:t}):(r=a&&a.orderby,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+'">',(r=e.text)?n=r.call(a,{hash:{},data:t}):(r=a&&a.text,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+'<i class="',(r=e.arrow)?n=r.call(a,{hash:{},data:t}):(r=a&&a.arrow,n=typeof r===v?r.call(a,{hash:{},data:t}):r),l+=m(n)+' ml5"></a></i></li>            \r\n        '}function p(){return"cur"}function f(a,t){var n,r="";return r+='\r\n    <ul class="search-order clearfix">        \r\n        ',n=e.each.call(a,a&&a.sort_btn,{hash:{},inverse:y.noop,fn:y.program(10,h,t),data:t}),(n||0===n)&&(r+=n),r+="\r\n    </ul>\r\n    "}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),r=r||{};var u,_="",v="function",m=this.escapeExpression,y=this;return _+='<div class="w1000">\r\n    ',u=e["if"].call(t,t&&t.is_no_data,{hash:{},inverse:y.program(3,i,r),fn:y.program(1,l,r),data:r}),(u||0===u)&&(_+=u),_+="\r\n    \r\n</div>\r\n\r\n",u=e.unless.call(t,t&&t.is_no_data,{hash:{},inverse:y.noop,fn:y.program(8,c,r),data:r}),(u||0===u)&&(_+=u),_}),$=require("components/jquery/jquery.js"),utility=require("common/utility/index"),selectbox=require("yue_ui/selectbox/selectbox"),search_class=function(a){var t=this;a=a||{},t.options=a,t.total_data=t.options.total_data||[],t.select_use_change=t.options.select_use_change||!1,t.icon_search=t.options.icon_search,t.icon_tips=t.options.icon_tips,t.$input_container=t.options.input_container||{},t.$filt_data_container=t.options.filt_data_container||{},t.$sort_btn_list=t.options.sort_btn_list||{},t.$input_container.parent().addClass("ui-search-com"),t.search_url=window.$__project_domain+"/search/",t.init()};search_class.prototype={init:function(){var a=this;a.render_input_container(a.total_data.input_data),a.render_filter_container({type_data:a.total_data.type_data,filter_data:a.total_data.filter_data,is_no_data:a.total_data.input_data.is_no_data}),a.render_sort_container(a.total_data.sort_data),a.setup_event()},render_input_container:function(a){var t=this;if(t.$input_container.length){a=$.extend(a,{icon_search:t.icon_search,search_url:t.search_url,select_use_change:t.select_use_change});var e=search_tpl(a);t.$input_container.html(e),selectbox(t.$input_container.find("select")[0])}},render_filter_container:function(a){var t=this;if(t.$filt_data_container.length){var e=filter_tpl(a);t.$filt_data_container.html(e)}},render_sort_container:function(a){var t=this;if(t.$sort_btn_list.length){a=$.extend(a,{icon_tips:t.icon_tips});var e=sort_tpl(a);t.$sort_btn_list.html(e)}},setup_event:function(){var a=this;if(a.$input_container.length&&(a.setup_select(),a.setup_submit()),a.$filt_data_container.length&&a.set_more_btn_show(),a.$sort_btn_list.length>0){var t=a.$sort_btn_list.find("[data-sort-arr]");t.on("click",function(a){var t=$(a.currentTarget),e=t.attr("data-sort-arr").split(","),n=t.attr("data-orderby");if(n)for(var r=0;r<e.length;r++){if(n!=e[r]){n=e[r];break}n=e[r]}else n=e[0];{var l="http://"+window.location.host+window.location.pathname+window.location.search;window.location.hash.substr(1)}return l=change_url_params(l,"orderby",n),l=change_url_params(l,"p",1),window.location.href=l+"#px",!1})}},set_more_btn_show:function(){var a=this,t=a.$filt_data_container.find('[data-role="search-filter-list"]');t.each(function(){var a=$(this).width(),t=$(this).find('[data-role="search-filter-list-items"]'),e=0,n=$(this).find(".more");t.each(function(){e+=$(this).outerWidth()}),a>=e?n.addClass("fn-hide"):n.removeClass("fn-hide")}),a.$filt_data_container.find(".more").on("click",function(){var a=$(this);if(!a.hasClass("fn-hide")){var t=a.parent('[data-role="search-filter-list"]');t.hasClass("extend")?(t.removeClass("extend"),t.find("ul").removeClass("auto"),a.find("i").removeClass("top").addClass("bottom"),a.removeClass("top").addClass("bottom").find("em").html("展开")):(t.addClass("extend"),a.find("i").removeClass("bottom").addClass("top"),a.removeClass("bottom").addClass("top").find("em").html("收起"),t.find("ul").addClass("auto"))}})},setup_select:function(){{var a=this,t=a.$input_container.find('[data-role="search_service_type"]');a.$input_container.find('[data-role="search_text"]')}t.on("change",function(){var t=$(this),e=t.val();"seller"==e?(a.$input_container.find('[data-role="seller-input-container"]').show(),a.$input_container.find('[data-role="goods-input-container"]').hide(),a.$input_container.find('[data-role="seller-input-container"]').find("input").removeAttr("disabled"),a.$input_container.find('[data-role="goods-input-container"]').find("input").attr("disabled","disabled")):"goods"==e&&(a.$input_container.find('[data-role="seller-input-container"]').hide(),a.$input_container.find('[data-role="goods-input-container"]').show(),a.$input_container.find('[data-role="goods-input-container"]').find("input").removeAttr("disabled"),a.$input_container.find('[data-role="seller-input-container"]').find("input").attr("disabled","disabled"))})},setup_submit:function(){function a(){if("none"!=t.$input_container.find('[data-role="seller-input-container"]').css("display")){t.$input_container.find('[data-role="seller-input-container"]').find('[data-role="label-place-holder"]').css("visibility","hidden").hide();{var a=t.$input_container.find('[data-role="seller-input-container"]').find('[data-role="search_text"]');a.val()}a.focus()}else{t.$input_container.find('[data-role="goods-input-container"]').find('[data-role="label-place-holder"]').css("visibility","hidden").hide();{var a=t.$input_container.find('[data-role="goods-input-container"]').find('[data-role="search_text"]');a.val()}a.focus()}}var t=this,e=(t.$input_container.find('[data-role="label-place-holder"]'),t.$input_container.find('[data-role="search_text"]')),n=t.$input_container.find('[data-role="default-url"]'),r=t.$input_container.find("#search-form"),l=t.$input_container.find('[data-role="default-search-text"]');$.trim(e.val())||e.focus(),r.on("submit",function(){if(n.val()&&!$.trim(a.val()))return window.location.href=n.val(),!1;if(n.val()||n.attr("disabled","disabled"),$.trim(l.val())||l.attr("disabled","disabled"),"none"!=t.$input_container.find('[data-role="seller-input-container"]').css("display"))var a=t.$input_container.find('[data-role="seller-input-container"]').find('[data-role="search_text"]');else var a=t.$input_container.find('[data-role="goods-input-container"]').find('[data-role="search_text"]');return $.trim(a.val())?void(!$.trim(a.val())&&$.trim(l.val())&&(a.val(l.val()),r.submit())):(alert("请输入关键字"),!1)}),t.$input_container.find(".search-text").each(function(e,n){$(n).on("click",function(){a()}),$(n).find('[data-role="search_text"]').on("input propertychange",function(){a()}),$(n).find('[data-role="search_text"]').on("blur",function(){if("none"!=t.$input_container.find('[data-role="seller-input-container"]').css("display")){var a=t.$input_container.find('[data-role="seller-input-container"]').find('[data-role="search_text"]');a.val().length||t.$input_container.find('[data-role="seller-input-container"]').find('[data-role="label-place-holder"]').css("visibility","visible").show()}else{var a=t.$input_container.find('[data-role="goods-input-container"]').find('[data-role="search_text"]');a.val().length||t.$input_container.find('[data-role="goods-input-container"]').find('[data-role="label-place-holder"]').css("visibility","visible").show()}})})}},exports.init=function(a){return new search_class(a)}});