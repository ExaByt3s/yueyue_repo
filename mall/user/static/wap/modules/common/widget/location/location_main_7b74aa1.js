define("common/widget/location/location_main",function(a){function i(a){var a=a||{};this.ele_tpl=a.ele,this.hot_city=a.hot_city||{},this.city_history_num=a.city_history_num||12,this.is_search=a.is_search||!1,this.callback=a.callback,this.all_hot_city_base=n.data.concat(this.hot_city.data),this.all_hot_city=[{title:n.title,data:this.all_hot_city_base,id:n.id}],this.init()}var t=a("components/zepto/zepto.js"),n=a("common/widget/location/hot_city_base"),l=a("common/utility/index"),e=a("common/widget/location/all_city");return i.prototype={init:function(){var a=this;a.setup_event(),a.is_search&&a.search_city(),a.render(a.ele_tpl),a.navigation()},setup_event:function(){Array.prototype.uniqueFn=function(){for(var a=[],i=0;i<this.length;i++)-1==a.indexOf(this[i])&&a.push(this[i]);return a}},render:function(a){var i=this,t=Handlebars.template(function(a,i,t,n,l){return this.compilerInfo=[4,">= 1.0.0"],t=this.merge(t,a.helpers),l=l||{},'<div class="location-mod" data-role="location">\n\n    <div data-role="local_storage_city" class="local-city city-style">\n        \n    </div>\n\n    <div data-role="hot_city" class="city-style">\n        \n    </div>\n\n    <div data-role="all_city" >\n        \n    </div>\n\n\n    <div class="flight-ctltsfixed">\n        <div class="flight-ctltsfixed-pd" >\n            <ul class="flight-ctlts" data-role="navigation">\n                <li nav-id="history">历史</li>\n                <li nav-id="hot">热门</li>\n                <li nav-id="A">A</li>\n                <li nav-id="B">B</li>\n                <li nav-id="C">C</li>\n                <li nav-id="D">D</li>\n                <li nav-id="E">E</li>\n                <li nav-id="F">F</li>\n                <li nav-id="G">G</li>\n                <li nav-id="H">H</li>\n                <li nav-id="I">I</li>\n                <li nav-id="J">J</li>\n                <li nav-id="K">K</li>\n                <li nav-id="L">L</li>\n                <li nav-id="M">M</li>\n                <li nav-id="N">N</li>\n                <li nav-id="O">O</li>\n                <li nav-id="P">P</li>\n                <li nav-id="Q">Q</li>\n                <li nav-id="R">R</li>\n                <li nav-id="S">S</li>\n                <li nav-id="T">T</li>\n                <li nav-id="U">U</li>\n                <li nav-id="V">V</li>\n                <li nav-id="W">W</li>\n                <li nav-id="X">X</li>\n                <li nav-id="Y">Y</li>\n                <li nav-id="Z">Z</li>\n            </ul>\n        </div>\n    </div>\n\n\n</div>'});i.current_view=a.html(t({})),i.all_city_ele=i.current_view.find("[data-role=all_city]"),i.render_all_city(),i.top_main_ele=i.current_view.find("[data-role=location]"),i.navigation_ele=i.current_view.find('[data-role="navigation"]'),i.hot_city_ele=i.current_view.find("[data-role=hot_city]"),i.hot_city.is_show?i.render_hot_city():i.navigation_ele.find('[nav-id="hot"]').addClass("fn-hide"),i.local_storage_city_ele=i.current_view.find('[data-role="local_storage_city"]'),i.on_local_storage_city(),i.render_local_storage_city()},render_hot_city:function(){var a=this,i=Handlebars.template(function(a,i,t,n,l){function e(a,i){var n,l,e="";return e+=' \n    <div class="title" data-id="',(l=t.id)?n=l.call(a,{hash:{},data:i}):(l=a&&a.id,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'">',(l=t.title)?n=l.call(a,{hash:{},data:i}):(l=a&&a.title,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'</div>\n    <div class="city-wrap clearfix">\n        ',n=t.each.call(a,a&&a.data,{hash:{},inverse:h.noop,fn:h.program(2,o,i),data:i}),(n||0===n)&&(e+=n),e+="\n    </div>\n"}function o(a,i){var n,l,e="";return e+=' \n            <div class="item" data-role="item" location_id="',(l=t.location_id)?n=l.call(a,{hash:{},data:i}):(l=a&&a.location_id,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'">',(l=t.city)?n=l.call(a,{hash:{},data:i}):(l=a&&a.city,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+"</div>\n        "}this.compilerInfo=[4,">= 1.0.0"],t=this.merge(t,a.helpers),l=l||{};var c,d="",s="function",r=this.escapeExpression,h=this;return d+="\n",c=t.each.call(i,i&&i.data_main,{hash:{},inverse:h.noop,fn:h.program(1,e,l),data:l}),(c||0===c)&&(d+=c),d+="\n\n    \n\n\n    \n"});a.hot_city_ele.html(i({data_main:a.all_hot_city}))},render_all_city:function(){{var a=this,i=Handlebars.template(function(a,i,t,n,l){function e(a,i){var n,l,e="";return e+=' \n    <div class="title" data-id="',(l=t.id)?n=l.call(a,{hash:{},data:i}):(l=a&&a.id,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'">',(l=t.title)?n=l.call(a,{hash:{},data:i}):(l=a&&a.title,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'</div>\n    <div class="city-wrap clearfix">\n        ',n=t.each.call(a,a&&a.data,{hash:{},inverse:h.noop,fn:h.program(2,o,i),data:i}),(n||0===n)&&(e+=n),e+="\n    </div>\n"}function o(a,i){var n,l,e="";return e+=' \n            <div class="item" data-role="item" location_id="',(l=t.location_id)?n=l.call(a,{hash:{},data:i}):(l=a&&a.location_id,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'">',(l=t.city)?n=l.call(a,{hash:{},data:i}):(l=a&&a.city,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+"</div>\n        "}this.compilerInfo=[4,">= 1.0.0"],t=this.merge(t,a.helpers),l=l||{};var c,d="",s="function",r=this.escapeExpression,h=this;return d+="\n",c=t.each.call(i,i&&i.data_main,{hash:{},inverse:h.noop,fn:h.program(1,e,l),data:l}),(c||0===c)&&(d+=c),d+="\n\n    \n\n\n    \n"});a.all_city_ele.html(i({data_main:e}))}},on_local_storage_city:function(){var a=this;a.top_main_ele.find('[data-role="item"]').on("click",function(){var i=t(this).attr("location_id"),n=t(this).html(),l={location_id:i,city:n};a.set_local_storage_city(l),a.render_local_storage_city(),a.navigation_ele.find("[nav-id=history]").removeClass("fn-hide")})},set_local_storage_city:function(a){var i=this,t=[];i.callback&&i.callback.call(this,a),t.push(a);var n=l.storage.get("location_map");n&&(t=t.concat(n));for(var e=[],o=[],c=[],d=0;d<t.length;d++)e.push(t[d].location_id),o[t[d].location_id]=t[d].city;for(var s=e.uniqueFn(),d=0;d<s.length;d++)c.push({location_id:s[d],city:o[s[d]]});l.storage.set("location_map",c)},render_local_storage_city:function(){var a=this,i=l.storage.get("location_map");if(i){for(var n=[],e=0;e<i.length;e++)e<a.city_history_num&&n.push(i[e]);var o=[{title:"历史",id:"history",data:n}],c=Handlebars.template(function(a,i,t,n,l){function e(a,i){var n,l,e="";return e+=' \n    <div class="title" data-id="',(l=t.id)?n=l.call(a,{hash:{},data:i}):(l=a&&a.id,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'">',(l=t.title)?n=l.call(a,{hash:{},data:i}):(l=a&&a.title,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'</div>\n    <div class="city-wrap clearfix">\n        ',n=t.each.call(a,a&&a.data,{hash:{},inverse:h.noop,fn:h.program(2,o,i),data:i}),(n||0===n)&&(e+=n),e+="\n    </div>\n"}function o(a,i){var n,l,e="";return e+=' \n            <div class="item" data-role="item" location_id="',(l=t.location_id)?n=l.call(a,{hash:{},data:i}):(l=a&&a.location_id,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+'">',(l=t.city)?n=l.call(a,{hash:{},data:i}):(l=a&&a.city,n=typeof l===s?l.call(a,{hash:{},data:i}):l),e+=r(n)+"</div>\n        "}this.compilerInfo=[4,">= 1.0.0"],t=this.merge(t,a.helpers),l=l||{};var c,d="",s="function",r=this.escapeExpression,h=this;return d+="\n",c=t.each.call(i,i&&i.data_main,{hash:{},inverse:h.noop,fn:h.program(1,e,l),data:l}),(c||0===c)&&(d+=c),d+="\n\n    \n\n\n    \n"}),d=a.local_storage_city_ele.html(c({data_main:o}));d.find('[data-role="item"]').on("click",function(){var i=t(this).attr("location_id"),n=t(this).html(),l={location_id:i,city:n};a.set_local_storage_city(l),a.render_local_storage_city()})}else a.navigation_ele.find("[nav-id=history]").addClass("fn-hide")},clear_storage_city:function(){l.storage.remove("location_map")},navigation:function(){var a=this,i=a.navigation_ele;a.navigation_ele.on("touchstart",function(a){function n(){t("[data-id="+e+"]").offset()&&window.scrollTo(0,t("[data-id="+e+"]").offset().top)}i.find(".flight-ctlts-selected").remove();var l=t(a.target),e=l.attr("nav-id");"history"==e?(n(),e="历史"):"hot"==e?(n(),e="热门"):n();var o='<div class="flight-ctlts-selected">'+e+"</div>";l.append(o)}),a.navigation_ele.on("touchend",function(){i.find(".flight-ctlts-selected").remove()})},search_city:function(){console.log("搜索")}},i});