define("search",function(e){var t=e("components/zepto/zepto.js"),s=e("common/utility/index"),r=Handlebars.template(function(e,t,s,r,n){function a(e,t){var r,n,a="";return a+='\n    <button data-role="btn" class="ui-button ui-button-size-x ui-button-bg-fff hot-btn" data-code-name="',(n=s.name)?r=n.call(e,{hash:{},data:t}):(n=e&&e.name,r=typeof n===l?n.call(e,{hash:{},data:t}):n),a+=_(r)+'">\n        <span>',(n=s.name)?r=n.call(e,{hash:{},data:t}):(n=e&&e.name,r=typeof n===l?n.call(e,{hash:{},data:t}):n),a+=_(r)+"</span>\n    </button>\n"}this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,e.helpers),n=n||{};var o,i="",l="function",_=this.escapeExpression,c=this;return i+="\n",o=s.each.call(t,(o=t&&t.data,null==o||o===!1?o:o.btn_list),{hash:{},inverse:c.noop,fn:c.program(1,a,n),data:n}),(o||0===o)&&(i+=o),i});t(document).ready(function(){function e(){var e=null;if("goods"==a.type){var t="service-history",e=a.service_tags;a.$history_service_content.removeClass("fn-hide"),a.$history_seller_content.addClass("fn-hide")}else if("seller"==a.type){var t="seller-history",e=a.seller_tags;a.$history_seller_content.removeClass("fn-hide"),a.$history_service_content.addClass("fn-hide")}var r=s.storage.get(a.type_id+"_"+t)||[];r.length>0?(a.$empty.removeClass("fn-hide"),a.$history.removeClass("fn-hide")):(a.$empty.addClass("fn-hide"),a.$history.addClass("fn-hide")),e.length>0?a.$hot.removeClass("fn-hide"):a.$hot.addClass("fn-hide")}function n(e,t){if("goods"==t)var r="service-history";else if("seller"==t)var r="seller-history";for(var n=s.storage.get(a.type_id+"_"+r)||[],o=!1,i=0;i<n.length;i++)n[i].name==e&&(o=!0);o||(n.length>=10&&n.pop(),n.unshift({name:e}),s.storage.set(a.type_id+"_"+r,n)),a.$search_type_init.val(a.type),window.location.href="./list.php?type="+encodeURIComponent(t)+"&keyword="+encodeURIComponent(e)+"&type_id="+a.type_id}t('[data-role="page-back"]').on("click",function(){document.referrer?window.history.back():window.location.href="../index.php"}),document.body.addEventListener("touchstart",function(){});var a=t({});if(a.$search_merchant=t('[data-role="merchant"]'),a.$search_service=t('[data-role="service"]'),a.$hot_service_content=t('[data-role="hot-service-content"]'),a.$hot_seller_content=t('[data-role="hot-seller-content"]'),a.$history=t('[data-role="history"]'),a.$history_service_content=t('[data-role="history-service-content"]'),a.$history_seller_content=t('[data-role="history-seller-content"]'),a.$empty=t('[data-role="empty"]'),a.$type_btn=t('[data-role="type-btn"]'),a.$search_btn=t('[data-role="right-btn"]'),a.$search_text=t('[data-role="search-text"]'),a.$search_type_txt=t(".search-type-btn"),a.$type_select=t("#type-select"),a.$hot=t('[data-role="hot"]'),a.$search_type_init=t("#search-type-init"),a.service_tags=window.__service_tags||[],a.service_btn_list=[],a.seller_tags=window.__seller_tags||[],a.seller_btn_list=[],a.type_id=window.__type_id,a.service_tags.length>0)for(var o=0;o<a.service_tags.length;o++){var i={};i.name=a.service_tags[o],a.service_btn_list.push(i)}if(a.seller_tags.length>0)for(var o=0;o<a.seller_tags.length;o++){var i={};i.name=a.seller_tags[o],a.seller_btn_list.push(i)}a.type=a.$search_type_init.val()||"goods",e(),"goods"==a.$search_type_txt.val()&&a.$search_type_txt.val("服务"),a.$type_btn.on("click",function(){var r="服务";if(a.type=t(this).attr("data-type"),a.$type_select.addClass("fn-hide"),"seller"==a.type){r="商家";var n="seller-history";a.$hot_seller_content.removeClass("fn-hide"),a.$history_seller_content.removeClass("fn-hide"),a.$hot_service_content.addClass("fn-hide"),a.$history_service_content.addClass("fn-hide")}else if("goods"==a.type){r="服务";var n="service-history";a.$hot_service_content.removeClass("fn-hide"),a.$history_service_content.removeClass("fn-hide"),a.$hot_seller_content.addClass("fn-hide"),a.$history_seller_content.addClass("fn-hide");{s.storage.get(a.type_id+"_"+n)||[]}}e(),a.$search_type_txt.val(r)}),a.$search_btn.on("click",function(){var e=a.$search_text.val();return t.trim(e)?(n(e,a.type),void a.$search_text.val("")):(alert("请输入内容"),void console.log("请输入内容"))}),t('[data-role="search-type"]').on("click",function(e){e.stopPropagation(),a.$type_select.hasClass("fn-hide")?a.$type_select.removeClass("fn-hide"):a.$type_select.addClass("fn-hide")}),t(document).on("click",function(){a.$type_select.addClass("fn-hide")});var l=function(e){var t=this;e=e||{},t.options=e,t.init()};l.prototype={init:function(){{var e=this,r=e.options.data||[];e.options.key||""}e.$el=e.options.$el||{},"goods"==a.type?e.$el.lst_key="service-history":"seller"==a.type&&(e.$el.lst_key="seller-history");var o=(s.storage.get(a.type_id+"_"+e.$el.lst_key)||[],e.render_items(r));e.$el.html(o),a.$btn=e.$el.find('[data-role="btn"]'),a.$btn.on("click",function(e){var s=t(e.currentTarget),r=s.attr("data-code-name");n(r,a.type)}),a.$empty.on("click",function(){if("goods"==a.type){var t="service-history";a.$history.addClass("fn-hide")}else if("seller"==a.type){var t="seller-history";a.$history.addClass("fn-hide")}s.storage.remove(a.type_id+"_"+t),e.setup_empty()})},render_items:function(e){var t=r(e);return t},setup_search_click:function(){},setup_empty:function(){a.$empty.addClass("fn-hide")}},a.search_hot_service_items_child_obj=new l({key:"hot_service",data:{data:{btn_list:a.service_btn_list}},title:"",$el:a.$hot_service_content}),a.search_history_service_items_child_obj=new l({key:"history_service",data:{data:{btn_list:s.storage.get(a.type_id+"_service-history")||[]}},title:"",$el:a.$history_service_content}),a.search_hot_seller_items_child_obj=new l({key:"hot_seller",data:{data:{btn_list:a.seller_btn_list}},title:"",$el:a.$hot_seller_content}),a.search_history_seller_items_child_obj=new l({key:"history_seller",data:{data:{btn_list:s.storage.get(a.type_id+"_seller-history")||[]}},title:"",$el:a.$history_seller_content})})});