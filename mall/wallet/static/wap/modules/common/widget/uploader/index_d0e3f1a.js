define("common/widget/uploader/index",function(e,i,a){var t=e("components/zepto/zepto.js"),l=e("common/I_APP/I_APP"),n=e("common/utility/index"),o=e("common/cookie/index"),d=Handlebars.template(function(e,i,a,t,l){function n(e,i){var t,l,n,r="";return r+='\n    <div class="ui-uploader-items-container " ',l=a.if_equal||e&&e.if_equal,n={hash:{},inverse:h.program(4,d,i),fn:h.program(2,o,i),data:i},t=l?l.call(e,e&&e.is_add_btn,"1",n):p.call(e,"if_equal",e&&e.is_add_btn,"1",n),(t||0===t)&&(r+=t),r+='>\n        <div class="ui-uploader-items ',(l=a.is_active)?t=l.call(e,{hash:{},data:i}):(l=e&&e.is_active,t=typeof l===u?l.call(e,{hash:{},data:i}):l),r+=g(t)+'" style="width:',(l=a.width)?t=l.call(e,{hash:{},data:i}):(l=e&&e.width,t=typeof l===u?l.call(e,{hash:{},data:i}):l),r+=g(t)+";height:",(l=a.height)?t=l.call(e,{hash:{},data:i}):(l=e&&e.height,t=typeof l===u?l.call(e,{hash:{},data:i}):l),r+=g(t)+';display: inline-block;" >\n            ',l=a.if_equal||e&&e.if_equal,n={hash:{},inverse:h.program(8,s,i),fn:h.program(6,c,i),data:i},t=l?l.call(e,e&&e.is_add_btn,"1",n):p.call(e,"if_equal",e&&e.is_add_btn,"1",n),(t||0===t)&&(r+=t),r+="\n\n        </div>\n        <!---->\n    </div>\n\n"}function o(){return'data-role="plus"'}function d(){return'data-role="upload-items"'}function c(e,i){var t,l,n="";return n+='\n                <div id="upload-flag">\n                    <img src="',(l=a.default_img_url)?t=l.call(e,{hash:{},data:i}):(l=e&&e.default_img_url,t=typeof l===u?l.call(e,{hash:{},data:i}):l),n+=g(t)+'" style="max-height: 100%;max-width: 100%;">\n                </div>\n            '}function s(e,i){var t,l,n="";return n+='\n                <i data-lazyload-url="',(l=a.img_url)?t=l.call(e,{hash:{},data:i}):(l=e&&e.img_url,t=typeof l===u?l.call(e,{hash:{},data:i}):l),n+=g(t)+'" class="image-img"></i>\n                <div class="close-out " data-role="del-pic" ><i class="icon close-btn"></i></div>\n                <input type="text" class="fn-hide" value="',(l=a.img_url)?t=l.call(e,{hash:{},data:i}):(l=e&&e.img_url,t=typeof l===u?l.call(e,{hash:{},data:i}):l),n+=g(t)+'" data-role="img-input-url">\n            '}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),l=l||{};var r,u="function",g=this.escapeExpression,h=this,p=a.helperMissing;return r=a.each.call(i,i&&i.list,{hash:{},inverse:h.noop,fn:h.program(1,n,l),data:l}),r||0===r?r:""}),c=e("common/lazyload/lazyload");!function(e){var i=function(e){e=e||{};var i=e.params||{},a=0,l=0,n={poco_id:o.get("yue_member_id"),sh_type:"merchandise"};n=t.extend(!0,n,e.formData),n=JSON.stringify(n);var d={chunked:!1,chunkSize:524288,server:"http://sendmedia-w.yueus.com:8079/upload.cgi",auto:!1,cover_img:"",runtimeOrder:"html5",formData:{params:n},accept:{title:"Images",extensions:"jpg,jpeg,png",mimeTypes:"image/*"},fileVal:"opus",disableGlobalDnd:!0,fileNumLimit:20,fileSizeLimit:209715200,fileSingleSizeLimit:52428800};i=t.extend(!0,d,e);var c=(function(){var e=new Image,i=!0;return e.onload=e.onerror=function(){(1!=this.width||1!=this.height)&&(i=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i}(),WebUploader.create(i));return c.file_count=a,c.file_size=l,c.state="pedding",c.map_obj={},c.$el=t(i.pick.id),c.on("fileQueued",function(e){c.file_count++,c.file_size+=e.size,c.map_obj[e.id]=e}),c.on("fileDequeued",function(e){c.file_count--,c.file_size-=e.size,c.map_obj[e.id]&&delete c.map_obj[e.id]}),c.get_file_by_id=function(e){return c.map_obj[e]||""},c.on("error",function(e){switch(console.log("%c"+e,"color:red"),e){case"Q_EXCEED_NUM_LIMIT":alert("上传文件数量超出上限了");break;case"Q_EXCEED_SIZE_LIMIT":alert("上传文件大小超出上限了");break;case"Q_TYPE_DENIED":alert("上传文件类型格式错误");break;case"F_EXCEED_SIZE":alert("上传文件大小超出上限了")}}),c};e.yueyue_uploader=i}(window),a.exports={init:function(){var e=this;return e.total_count=0,e},plus_btn:function(e){var i=this,a={};a.default_img_url="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3tpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpENDZEQ0I5RjQwMDdFNDExODJEREMzQzk1NTAyQzA5MiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBNjI0RUFDQUE2OUYxMUU0QUQ3RUUwNzA4OUI5NzhCNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBNjI0RUFDOUE2OUYxMUU0QUQ3RUUwNzA4OUI5NzhCNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MTg2NDhhMDAtMmQ2OS0yMjQzLWJiZDMtNmQzYWQ0OTg2MTZkIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZWYyMzJhMDktMTdiOC0xMWU0LThlYmMtZDk2MDViOWUyM2M5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+gWRlewAABElJREFUeNrt2stqXWUYgOHXnRgVvQexIB7i4QZ0Ig4q9S4stKIgFcGBYweCeACFFvUGOlbsoHSiXoC29TCpeA0qYiStA/+tmyDYqF3JXnkeCNndySrt3zcrX3a/286fP98eD1cnq2eq+6o7xvO37fm8G92cqa87qGtdN811v1bXqgvVh9XXq5+0WHm8Vb1XXa7OVA+uxAyHxR3VQ6PRy9XZ6q7lBzdXYv6kenrlwq/HV8Cn1fc38RX0b++At/q6g7rWdf/vdXdWx6rjY4J4eNyQT1X3j4liZ3mHfnsl5p3qxerR8fy34zYPB+nX6pvR5KPV6eqX8bGnqreWI8f2qHwZ84nq/eq6M+SQul6dq54dzTYC316M2/fGePJMddF5sSYuVS+PxxvVycWYSaqujuphnZwd7VYdX4xBu/ED4K7zYc3sjnarji3GKxz1x+t6sI6W7W6tvg59zbmwpv5sd7P/9hotHAY7y44XzoI5ETSChsNqs7+2mMzSrLMb7tAYOUDQIGgQNIIGQYOgQdCwD7btmAvbdhg5QNAw5Qxt2445sG2HkQMEDYIGQSNoEDQIGgQN+2HbjrmwbYeRAwQNU87Qtu2YA9t2GDlA0CBoEDSCBkGDoEHQIGiOLOujzIX1UYwcIGiYcoa2PsocWB/FyMG/83r143iPoNfeq9U91SuOQtBzsDHebzkKQYOgETQIGgQNgoZ/Zn2UubA+ipEDBA1TztDWR5kD66MYOUDQIGgQNIIGQYOgQdCwH7btmAvbdhg5QNAw5Qxt2445sG2HkQMEfYh8Nr41Tf2291vj1G+fCXqenjiiN64nBD1Pnx/RoL84Kn/RzSP2D/vkQf4EPng1yR0aBI2gYf1naDMdc2DbDiMHCBqmnKFt2zEHtu0wcoCgQdAgaAQNggZBg6BhP2zbMRe27TBygKBhyhnath1zYNsOIwcIGgQNgkbQTGF3vN9xFIKegzeqn6s3HcWttekIJvHaeMMdGvZ3h/Y/hMyBbTuMHCBomHKGtm3HHNi2w8gBggZBg6ARNAgaBA2Chv2wbcdc2LbDyAGChilnaNt2zIFtO4wcIGgQNAgaQYOgQdAgaNgP23bMhW07jBwgaJhyhrZtxxzYtsPIAYIGQYOgETQIGgQNgob9sG3HXNi2w8gBgoYpg74x3rYcB2vqnmXHq3foY86FNXXv6h16Zzw+7lxYU0+P9z8tqmvjF89VG86GNbNRnRyPf1hUF8YvHqlOOR/WzKnRbtXFRfVRtTueeHvl9g2H3VOj2UbDHy6qK9W58eRW9Un1Ql7S4/BajDvzx/316ty56soy2jPVxZWo36u+ql6qHqhud4YcsLur7dHkl9XZ6q7xsUuj4TbHEzvVieqt6vnxFbBdvbPyG+7d+bhxk3+Qqa87qGtdd2uv++lvPud69cGIeac9Y8VO9WL1WPVu9V31mxsDh8zP1dXR6OPV6eqX5Qd/B6Mc0P6p8XDBAAAAAElFTkSuQmCC",a.width=e.grid_size,a.height=a.width,a.is_add_btn="1",a.is_active="active",i.has_init_puls_btn=!0;var t=d({list:[a]});return t},add:function(e,i){for(var a=this,t=i.list,l=0;l<t.length;l++)t[l].is_add_btn="0",t[l].is_active="",t[l].width=i.grid_size,t[l].height=t[l].width,a.total_count++;var n=d(i);return a.$el=e,a.$el.append(n),a._setup_event(),a.lazyloading?a.lazyloading.refresh():a.lazyloading=new c(a.$el,{}),a},_setup_event:function(){var e=this;e.$el.find('[data-role="del-pic"]').one("click",function(i){e.total_count--;var a=t(i.currentTarget);a.parents(".ui-uploader-items-container").remove(),e.$el.trigger("delete:upload_items")}),e.$el.find('[data-role="upload-flag"]').on("click",function(){e.$el.trigger("click:upload_flag")})},show:function(){},hide:function(){},reset:function(){var e=this;e.render(e.$el,{list:[]})},upload_action:function(e){var i=this;if(l.isPaiApp)l.upload_img("multi_img",{is_async_upload:0,max_selection:1,is_zip:1},function(a){var t=[];if(i.pic_list=[],a.imgs.length>0)for(var l=0;l<a.imgs.length;l++){var o=n.matching_img_size(a.imgs[l].url,165);t[0]=o}i.pic_list=t,e.callback&&e.callback.call(this,t)});else{i.pic_list=[];var a=["http://image227-c.poco.cn/mypoco/myphoto/20140716/10/17371899920140716100604099_640.jpg"];i.pic_list=a,e.callback&&e.callback.call(this,a)}},init_webupload:function(e){e=e||{};var i=null,a=e.file_num_limit,l=e.picker_id;l||alert("没有传递初始化picker_id");var n={auto:!1,fileNumLimit:a,pick:{id:l,label:""},formData:e.form_data||{}};n=t.extend(!0,n,e),i=yueyue_uploader(n),i.imgs=[];var o=130,d=130;return i.on("startUpload",function(){"uploading"!=i.state&&i.upload()}),i.on("fileQueued",function(e){console.log(e),i.file_count>=1&&(i.refresh(),i.state="ready",i.makeThumb(e,function(e,i){e||console.log(i)},o,d))}),i.on("fileDequeued",function(){i.file_count||(i.state="pedding",i.refresh()),update_status(i.state,$upload_tips),console.log("remove file")}),i.on("uploadStart",function(e){e.id}),i.on("uploadProgress",function(e,i){console.log(i)}),i.on("uploadSuccess",function(e,i){if(console.log(i),i.url instanceof Array){i.url[0]||""}else{i.url+"?"+(new Date).getTime()||""}e.id}),i.on("uploadError",function(){i.imgs=[]}),i.on("uploadComplete",function(){}),i.on("uploadFinished",function(){}),i.on("all",function(e){switch(e){case"uploadFinished":case"uploadError":i.state="confirm";break;case"startUpload":i.state="uploading";break;case"stopUpload":i.state="paused"}}),i}}});