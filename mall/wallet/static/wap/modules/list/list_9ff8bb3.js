define("list",function(e){function a(e){var a=this,e=e||{};a.$render_ele=e.ele||{},a.send_url=e.url||"",a.ajax_params=e.params||{},a.ajax_type=e.ajax_type||"GET",a.template=e.template||{},a.is_open_lazyload=null==e.is_open_lazyload?!0:!1,a.is_open_lz_opts=e.is_open_lz_opts||"",a.init(e)}var n=e("components/zepto/zepto.js"),r=e("common/utility/index"),i=(e("yue_ui/frozen"),e("common/widget/abnormal/index")),o=e("common/lazyload/lazyload"),t=n({});return a.prototype={refresh:function(e){var a=this;e&&(a.ajax_params=n.extend(a.ajax_params,e)),a.page=1,a.action(a.page)},load_more:function(){var e=this;e._sending||(e.has_next_page?(e.page++,e.action(e.page)):e.$load_more.html("到底部了"))},init:function(){var e=this;t.$loading={},e.page=1,e.$render_ele.append('<div data-role="list"></div>'),e.$render_ele.append('<div class="" data-role="abnormal"></div>'),e.$render_ele.append('<div class="ui-list-load-more-btn fn-hide" data-role="load_more">正在加载...</div>'),e.$list_container=e.$render_ele.find('[data-role="list"]'),e.$abnormal=e.$render_ele.find('[data-role="abnormal"]'),e.$load_more=e.$render_ele.find('[data-role="load_more"]'),e.$el=e.$render_ele,e.refresh(),e.window_scroll_more()},action:function(e){var a=this;a._sending||(a.ajax_params=n.extend(a.ajax_params,{page:e}),t.ajax_obj=r.ajax_request({url:a.send_url,data:a.ajax_params,type:a.ajax_type,beforeSend:function(){a._sending=!0,t.$loading=n.loading({content:"加载中..."})},success:function(r){console.log(r),a._sending=!1;var o=r.result_data.list;if(a.$el.rq_status="success",a.$el.trigger("list_render:before",[a.$list_container,r]),t.$loading.loading("hide"),a.has_next_page=r.result_data.has_next_page,!o.length&&1==e)return i.render(a.$abnormal[0],{}),a.$abnormal.removeClass("fn-hide"),a.$list_container.addClass("fn-hide"),a.$load_more.addClass("fn-hide"),void a.$el.trigger("list_render:after",[a.$list_container,r,n(l)]);a.$abnormal.addClass("fn-hide"),a.$list_container.removeClass("fn-hide"),a.$load_more.removeClass("fn-hide");var l=a.template({list:o});1==e?a.$list_container.html(l):a.$list_container.append(l),a.$el.trigger("list_render:after",[a.$list_container,r,n(l)]),a.setup_event()},error:function(){a._sending=!1,t.$loading.loading("hide"),n.tips({content:"网络异常",stayTime:3e3,type:"warn"}),a.$el.trigger("request:error"),a.$el.rq_status="error"}}))},window_scroll_more:function(){var e=this;n(window).scroll(function(){e.$list_container.height()&&n(window).scrollTop()+n(window).height()>n(document).height()-50&&e.load_more()})},setup_event:function(){var e=this;if(e.is_open_lazyload)if(e.lazyloading)e.lazyloading.refresh();else{var a={size:window.innerWidth};e.is_open_lz_opts||(a={}),e.lazyloading=new o(n("body"),a)}e.$render_ele.height()<window.innerHeight&&e.$load_more.addClass("fn-hide")}},a});