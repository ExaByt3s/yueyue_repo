/**
 * dropload
 * 西门
 * 20141024 v0.1.0
 */

!function(a){"use strict";function n(a,b){a.css({"-webkit-transition":"all "+b+"ms",transition:"all "+b+"ms"})}var m,b={loadClass:"dropload-box",refreshDOM:'<div class="dropload-refresh">↓下拉刷新</div>',updateDOM:'<div class="dropload-update">↑释放更新</div>',loadDOM:'<div class="dropload-load">○加载中...</div>',direction:"up",distance:50},c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=!1,k=!1,l="";a.fn.dropload=function(a){return new m(this,a),this},m=function(b,c){var d=this;d.$element=a(b),d.init(b,c)},m.prototype.init=function(c,d){var e=this;e.options=a.extend({},b,d),l="."+e.options.loadClass,e.$element.on("touchstart",function(a){k||(e.fnTouches(a),e.fnTouchstart(a))}),e.$element.on("touchmove",function(a){k||(e.fnTouches(a),e.fnTouchmove(a))}),e.$element.on("touchend",function(){k||e.fnTouchend()})},m.prototype.fnTouches=function(a){a.touches||(a.touches=a.originalEvent.touches)},m.prototype.fnTouchstart=function(a){var b=this;c=a.touches[0].pageY,g=b.$element.height(),h=b.$element.children().height(),i=b.$element.scrollTop()},m.prototype.fnTouchmove=function(b){e=b.touches[0].pageY,d=e-c;var k=this,m=Math.abs(d);"up"==k.options.direction&&0>=i&&d>0&&(b.preventDefault(),j||(k.$element.prepend('<div class="'+k.options.loadClass+'"></div>'),j=!0),n(a(l),0),m<=k.options.distance?(f=m,a(l).html("").append(k.options.refreshDOM)):m>k.options.distance&&m<=2*k.options.distance?(f=k.options.distance+.5*(m-k.options.distance),a(l).html("").append(k.options.updateDOM)):f=k.options.distance+.5*k.options.distance+.2*(m-2*k.options.distance),a(l).css({height:f})),"down"==k.options.direction&&g+i>=h&&0>d&&(b.preventDefault(),j||(k.$element.append('<div class="'+k.options.loadClass+'"></div>'),j=!0),n(a(l),0),m<=k.options.distance?(f=m,a(l).html("").append(k.options.refreshDOM)):m>k.options.distance&&m<=2*k.options.distance?(f=k.options.distance+.5*(m-k.options.distance),a(l).html("").append(k.options.updateDOM)):f=k.options.distance+.5*k.options.distance+.2*(m-2*k.options.distance),a(l).css({height:f}),k.$element.scrollTop(f+i))},m.prototype.fnTouchend=function(){var b=this,c=Math.abs(d);j&&(n(a(l),300),c>b.options.distance?(a(l).css({height:a(l).children().height()}),a(l).html("").append(b.options.loadDOM),b.fnCallback()):a(l).css({height:"0"}).on("webkitTransitionEnd",function(){j=!1,a(this).remove()}),d=0)},m.prototype.fnCallback=function(){var a=this;k=!0,a.$element.trigger("dropload",a)},m.prototype.resetload=function(){a(l)&&a(l).css({height:"0"}).on("webkitTransitionEnd",function(){k=!1,j=!1,a(this).remove()})}}(window.Zepto||window.jQuery);