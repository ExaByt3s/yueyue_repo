<!DOCTYPE html>
<html lang="zh">
<head>
    <title>提交报价</title>
    <meta charset="gbk">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.3, user-scalable=0"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no"/>

<!-- modjs 必须引用 -->
<script type="text/javascript" charset="gbk" src="http://static.yueus.com/task/mpredev/static/lib/mod.js"></script>
<!--基础样式 START-->
<link type="text/css" rel="stylesheet" href="http://static.yueus.com/task/mpredev/static/style/base.css">
<!--基础样式 END-->

<!--tt START-->
<link type="text/css" rel="stylesheet" href="http://static.yueus.com/task/mpredev/static/style/task-m.css">
<!--tt END-->


<!--配置全局变量-->
<script>
	window.$__romain = window.location.origin;
	window.$__config = 
	{				
		ajax_url : '../ajax/'
	};
    console.log(window.localStorage.getItem("$__storage_first_tips"))
    if(window.localStorage.getItem("$__storage_first_tips"))
    {
        console.log("in")
    }
    else
    {
        console.log("in2")
        var data =
        {
            "details_1":1,
            "details_2":1,
            "submit_1":1,
            "pay_1":1,
            "talk_1":1
        }
        window.localStorage.setItem("$__storage_first_tips",JSON.stringify(data));
    }
</script>  
    <link type="text/css" rel="stylesheet" href="http://static.yueus.com/task/mpredev/static/style/submit/index.css">
<body>
<main role="main" >
    <div class="page-view submit-container" data-role="page-container">
        <div class="common_menu" >
    <div class="common_logo"><i class="icon icon-top-logo"></i></div>
	<div class="common_btn" data-role="common_btn_menu"><i class="icon icon-right-menu-logo"></i></div>
    
</div>
<div class="common_menu_open layout_box_v fn-hide" data-role="common_menu_open">
    <a data-role="common_menu_open_business" href="list.php">生意机会</a>
    <a data-role="common_menu_open_list" href="order_list.php?type=pending">订单列表</a>
    <a data-role="common_menu_open_mine" href="profile.php">个人中心</a>
    <a data-role="common_menu_open_log_out" href="logout.php">退出登录</a>
</div>
<!--modjs hack 特殊处理，增加head标记-->
<head><link type="text/css" rel="stylesheet" href="http://static.yueus.com/task/mpredev/static/style/frozen/frozen.css">
<script type="text/javascript" charset="gbk" src="http://static.yueus.com/task/mpredev/static/modules/common/cookie/index.js"></script>
<script type="text/javascript" charset="gbk" src="http://static.yueus.com/task/mpredev/components/zepto/zepto.js"></script>
<script type="text/javascript" charset="gbk" src="http://static.yueus.com/task/mpredev/static/modules/yue_ui/frozen.js"></script>
</head>
<!--modjs hack 特殊处理，增加head标记-->
<script type="text/javascript">
	
	var cookie = require('common/cookie/index');
	var $ = require('components/zepto/zepto.js');	

	(function($,window)
	{
		var self = this;

		var no_login = '{no_login}';

		var $common_menu_open = $('[data-role="common_menu_open"]');
		var $common_btn_menu  = $('[data-role="common_btn_menu"]');
		var $common_menu_open_log_out = $('[data-role="common_menu_open_log_out"]');

		if(!parseInt(cookie.get('yue_member_id')))
		{
			$common_btn_menu.hide();
		}

		$common_btn_menu.on('click',function()
		{	
			if(!parseInt(cookie.get('yue_member_id')))
			{
				return;
			}
			
			$common_menu_open.toggleClass("fn-hide");
		});

		$common_menu_open_log_out.on('click',function()
		{
			$.ajax
			({
				url: window.$__config.ajax_url + 'login_out.php',
				type: 'POST',
				cache: false,
				dataType: 'json',
				beforeSend: function () {

				},
				success: function (data) {
					window.location.href = './login.php';

				},
				error: function () {

				},
				complete: function () {

				}
			})
    })

	})($,window);
</script> 
        <div class="submit_title layout_box_v">
            <p>提交报价</p>
        </div>
        <div class="submit_back" data-role="submit_back">查看请求</div>
        <div class="submit_notice" data-role="submit_notice">点击查看需求，你在消息处填写的信息也将保存。</div>
        <div class="common_first_tips fn-hide" data-role="common_first_tips" storage-value="submit_1" style="background: #fff;padding-top: 0px;">
            <div class="con">
                <div class="delta bot"></div>
                <div class="txt">3条报价来自认证商家，5条来自普通商家（按报价时间排序，先报先推，满5条即不可再报价）</div>
                <div class="del" data-role="common_first_close"><div class="inn"></div></div>
            </div>
        </div>
        <div class="submit_container layout_box_v">
            <p>报价</p>
            <div class="submit_price layout_box">
                <div class="submit_price_coin">￥</div>
                <div class="submit_price_input layout_box_v">
                    <input type="text" data-role="price"/>
                </div>
            </div>
            <p>告诉{lead_info.from_nickname}选择你的原因</p>
            <p class="exp">用最精简的语言为自己代言吧</p>
            <div class="submit_reason layout_box">
                <textarea class="layout_box layout_box" data-role="content"></textarea>
            </div>
        </div>
        <div class="submit_btn" data-role="submit_btn">继续</div>
        <div class="submit_help_tip">需要帮助可以联系我们</div>
        <div class="submit_help_phone"><a href="tel:4000-82-9003" class="common_on_tel">4000-82-9003</a></div>
    </div>
</main>

</body>
<script>
    window.onload = function()
    {
        var details = JSON.parse(window.localStorage.getItem("$__storage_first_tips"));

        if(details && (details.submit_1 == 1))
        {
            $('[data-role="common_first_tips"]').removeClass('fn-hide');

            $('[data-role="submit_notice"]').addClass('fn-hide');
        }

        $('[data-role="common_first_close"]').on('click',function()
        {
            $(this).parents('[data-role="common_first_tips"]').addClass('fn-hide');

            details.submit_1 = 0;

            window.localStorage.setItem("$__storage_first_tips",JSON.stringify(details));
        })

        var lead_id = '{lead_info.lead_id}';

        var request_id = '{lead_info.request_id}';
        var yue_ui = require('yue_ui/frozen');

        $('[data-role="submit_btn"]').on('click',function()
        {
            var price = $('[data-role="price"]').val();
            var content = $('[data-role="content"]').val();

            console.log(parseInt(price) > 1);
            console.log(parseInt(price) < 999999);
            console.log(price.indexOf("."));
            console.log(price.indexOf(".") != -1);

            if(price.trim() == "" || !(parseInt(price) >= 1) || !(parseInt(price) <= 999999) || (price.indexOf(".") != -1)){
                alert("请正确填写价格");
                return;
            }
            if(content.trim() == ""){
                alert("请填写原因");
                return;
            }

            var data =
            {
                request_id:request_id,
                price : price,
                content : content
            };

            if(window.confirm('确认提交报价?'))
            {
                $.ajax
                ({
                    url : window.$__config.ajax_url+'/quote_act.php',
                    data:data,
                    type: 'POST',
                    dataType : 'json',
                    cache: false,
                    beforeSend: function()
                    {
                        $.loading
                        ({
                            content:'请求中...'
                        })
                    },
                    success: function(data)
                    {
                        alert(data.result_data.message);
                        if(data.result_data.code == 2)
                        {
                            window.location.href = './pay.php?quotes_id='+ data.result_data.quotes_id;
                        }
                        else if(data.result_data.code == 1)
                        {
                            window.location.href = './success.php';

                        }
                        console.log(data);
                    },
                    error: function()
                    {
                        $.loading.loading("hide");

                        $.tips
                        ({
                            content : '网络异常',
                            stayTime:3000,
                            type:"success"
                        });
                    }
                });
            }


        });

        $('[data-role="submit_back"]').on('click',function()
        {
            window.history.back();
        });
    }
</script>
</html>