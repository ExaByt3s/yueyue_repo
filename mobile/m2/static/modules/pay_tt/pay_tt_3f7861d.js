define("pay_tt",function(a){"use strict";var t=a("common/widget/back_btn/main"),n=a("common/utility/index"),e=a("components/zepto/zepto.js"),i=a("components/fastclick/fastclick.js"),s=(a("yue_ui/frozen"),a("common/I_APP/I_APP"));"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){i.attach(document.body)},!1),function(a,e){var i=a("#nav-header"),r=Handlebars.template(function(a,t,n,e,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,a.helpers),i=i||{};var s,r,c="",l="function",o=this.escapeExpression;return c+='<ul class="ui-list ui-list-text ui-border-b">\r\n	<li>\r\n		<div class="ui-avatar">\r\n		   <span style="background-image:url(\'',(r=n.user_icon)?s=r.call(t,{hash:{},data:i}):(r=t&&t.user_icon,s=typeof r===l?r.call(t,{hash:{},data:i}):r),c+=o(s)+'\')"></span>\r\n		</div>\r\n		<div class="ui-list-info ui-border-t">\r\n			<h4>',(r=n.user_nickname)?s=r.call(t,{hash:{},data:i}):(r=t&&t.user_nickname,s=typeof r===l?r.call(t,{hash:{},data:i}):r),c+=o(s)+'</h4>\r\n			<p>服务类型</p>\r\n		</div>\r\n	</li>				\r\n</ul>\r\n<ul class="ui-list ui-list-text">\r\n	<li class="ui-border-t">\r\n		<div class="ui-txt-default ">支付类型：<span>',(r=n.pay_type)?s=r.call(t,{hash:{},data:i}):(r=t&&t.pay_type,s=typeof r===l?r.call(t,{hash:{},data:i}):r),c+=o(s)+'</span></div>\r\n	</li>	\r\n	<li class="ui-border-t">\r\n		<div class="ui-txt-default ">报价金额：<span>￥',(r=n.total_amount)?s=r.call(t,{hash:{},data:i}):(r=t&&t.total_amount,s=typeof r===l?r.call(t,{hash:{},data:i}):r),c+=o(s)+'</span></div>\r\n	</li>\r\n	<li class="ui-border-t">\r\n		<div class="ui-txt-default ">支付定金：<span>￥',(r=n.pay_amount)?s=r.call(t,{hash:{},data:i}):(r=t&&t.pay_amount,s=typeof r===l?r.call(t,{hash:{},data:i}):r),c+=o(s)+'</span></div>\r\n	</li>\r\n</ul>\r\n\r\n<!--支付模块-->\r\n<ul class="ui-list ui-list-text mt20 fn-hide">\r\n	<li >\r\n		<div class="ui-txt-default ">钱包<span></span></div>\r\n	</li>	\r\n	<li >\r\n		<div class="ui-txt-default ">账户余额：<span>￥12.00</span></div>\r\n		<div class="ui-edge-right">\r\n			<span class="count-money-color">-￥12.00</span>\r\n			<i class="icon icon-select-active"></i>\r\n		</div>\r\n	</li>					\r\n</ul>\r\n<ul class="ui-list ui-list-text ui-border-b mt20">\r\n	<li class="ui-border-t">\r\n		<div class="ui-txt-default ">还需支付：<span class="count-money-color">￥',(r=n.pay_amount)?s=r.call(t,{hash:{},data:i}):(r=t&&t.pay_amount,s=typeof r===l?r.call(t,{hash:{},data:i}):r),c+=o(s)+'</span></div>\r\n	</li>	\r\n</ul>\r\n<ul class="ui-list ui-list-text last-container">\r\n	<li class="ui-border-t" data-pay-type="alipay_purse" data-role="pay-li">\r\n		<div class="ui-txt-default ">\r\n			<div class="pay-type">\r\n				<i class="icon icon-zhifubao"></i>\r\n				<div class="ui-list-info ">\r\n					<h4 class="ui-nowrap" >支付宝支付</h4>\r\n					<p class="ui-nowrap">推荐有支付宝账号的用户使用</p>\r\n				</div>\r\n			</div>\r\n			<div class="ui-edge-right">\r\n				<i class="icon icon-select-active" data-role="yes-tag"></i>\r\n			</div>\r\n		</div>\r\n	</li>	\r\n	<li class="ui-border-t" data-pay-type="tenpay_wxapp" data-role="pay-li">\r\n		<div class="ui-txt-default ">\r\n			<div class="pay-type">\r\n				<i class="icon icon-wx-pay"></i>\r\n				<div class="ui-list-info ">\r\n					<h4 class="ui-nowrap" >微信支付</h4>\r\n					<p class="ui-nowrap">安装微信5.0及以上版本的使用</p>\r\n				</div>\r\n			</div>\r\n			<div class="ui-edge-right">\r\n				<i class="icon icon-select-no" data-role="yes-tag"></i>\r\n			</div>\r\n		</div>\r\n	</li>\r\n</ul>\r\n<!--支付模块-->\r\n	<div class="buttom-btn-wrap">\r\n		<button class="ui-tt-pay-btn" id="pay-btn">\r\n			确认支付\r\n		</button>\r\n</div>'}),c={};c.quotes_id=a("#quotes_id").val(),c.$page_container=a('[data-role="page-container"]');var l=function(){var a=this;a.init()};l.prototype={refresh:function(){var t=this,i=a.loading({content:"加载中..."});n.ajax_request({url:e.$__config.ajax_url.get_tt_pay_info,data:{quotes_id:c.quotes_id},success:function(a){var n=a.result_data;c.$page_container.html(""),c.$page_container.html(r(n)),t.setup_event(),i.loading("hide")},error:function(){i.loading("hide"),a.tips({content:"网络异常",stayTime:3e3,type:"warn"})}})},page_back:function(){},init:function(){var a=this,n=t.render();i.prepend(n),a.setup_back()},hide:function(){},setup_back:function(){a('[data-role="page-back"]').on("tap",function(){s.isPaiApp&&s.app_back()})},setup_event:function(){var t=this;c.$pay_li=a('[data-role="pay-li"]'),c.$pay_btn=a("#pay-btn"),c.selected_pay_action_type="alipay_purse",c.$pay_li.on("click",function(t){var n=a(t.currentTarget),e=n.find('[data-role="yes-tag"]'),i=e.hasClass("icon-select-active");if(a('[data-role="yes-tag"]').removeClass("icon-select-active").addClass("icon-select-no"),i){e.removeClass("icon-select-active").addClass("icon-select-no");var s=0}else{e.addClass("icon-select-active").removeClass("icon-select-no");var s=n.attr("data-pay-type")}c.selected_pay_action_type=s}),c.$pay_btn.on("click",function(){if(!c.selected_pay_action_type)return void alert("请选择支付方式");if(confirm("确认支付?")){var i=e.location.href.replace("pay.php","pay_success.php"),r={third_code:c.selected_pay_action_type,quotes_id:c.quotes_id,redirect_url:i};t.pay_action(r,{success:function(i){var r=i.result_data&&i.result_data.third_code,c="pay_success.php?"+i.result_data.payment_no;switch(r){case"alipay_purse":s.alipay({alipayparams:i.result_data.request_data,payment_no:i.result_data.payment_no},function(i){var s=n.int(i.result),r=t.after_pay_text(s);a.tips({content:r,stayTime:3e3,type:"success"}),(1==s||-1==s||-2==s)&&(e.location.href=c)});break;case"tenpay_wxapp":s.wxpay(JSON.parse(i.result_data.request_data),function(i){var s=n.int(i.result),r=t.after_pay_text(s);a.tips({content:r,stayTime:3e3,type:"success"}),(1==s||-1==s||-2==s)&&(e.location.href=c)})}},error:function(){}})}})},pay_action:function(t,i){var s=a.loading({content:"发送中..."});n.ajax_request({url:e.$__config.ajax_url.pay_tt_action,data:t,type:"POST",success:function(t){if(s.loading("hide"),t.result_data&&t.result_data.result>0){i.success.call(this,t);var n="success"}else{var n="warn";a.tips({content:t.result_data.message,stayTime:3e3,type:n})}},error:function(){i.error.call(this,res),s.loading("hide"),a.tips({content:"网络异常",stayTime:3e3,type:"warn"})}})},after_pay_text:function(a){var t="";switch(n.int(a)){case 1:case-2:case-1:t="支付成功";break;case 0:t="其它错误";break;case-3:t="支付失败";break;case-4:t="支付取消"}return t}};var o=new l;o.refresh()}(e,window)});