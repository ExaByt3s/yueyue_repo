define("utility/megapix-image/megapix-image",[],function(e,t,a){!function(){function e(e){var t=e.naturalWidth,a=e.naturalHeight;if(t*a>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");return i.drawImage(e,-t+1,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function t(e,t,a){var r=document.createElement("canvas");r.width=1,r.height=a;var i=r.getContext("2d");i.drawImage(e,0,0);for(var n=i.getImageData(0,0,1,a).data,o=0,s=a,c=a;c>o;){var h=n[4*(c-1)+3];0===h?s=c:o=c,c=s+o>>1}var d=c/a;return 0===d?1:d}function r(e,t,a){var r=document.createElement("canvas");return i(e,r,t,a),r.toDataURL("image/jpeg",t.quality||.8)}function i(a,r,i,o){var s=a.naturalWidth,c=a.naturalHeight,h=i.width,d=i.height,g=r.getContext("2d");g.save(),n(r,g,h,d,i.orientation);var l=e(a);l&&(s/=2,c/=2);var u=1024,m=document.createElement("canvas");m.width=m.height=u;for(var f=m.getContext("2d"),w=o?t(a,s,c):1,v=Math.ceil(u*h/s),b=Math.ceil(u*d/c/w),L=0,I=0;c>L;){for(var p=0,R=0;s>p;)f.clearRect(0,0,u,u),f.drawImage(a,-p,-L),g.drawImage(m,0,0,u,u,R,I,v,b),p+=u,R+=v;L+=u,I+=b}g.restore(),m=f=null}function n(e,t,a,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r,e.height=a;break;default:e.width=a,e.height=r}switch(i){case 2:t.translate(a,0),t.scale(-1,1);break;case 3:t.translate(a,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(a,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-a,0)}}function o(e){if(window.Blob&&e instanceof Blob){var t=new Image,a=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!a)throw Error("No createObjectURL function found to create blob url");t.src=a.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,a=e.length;a>t;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}o.prototype.render=function(e,t){if(this.imageLoadListeners){var a=this;return void this.imageLoadListeners.push(function(){a.render(e,t)})}t=t||{};var n=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,s=t.width,c=t.height,h=t.maxWidth,d=t.maxHeight,g=!this.blob||"image/jpeg"===this.blob.type;s&&!c?c=o*s/n<<0:c&&!s?s=n*c/o<<0:(s=n,c=o),h&&s>h&&(s=h,c=o*s/n<<0),d&&c>d&&(c=d,s=n*c/o<<0);var l={width:s,height:c};for(var u in t)l[u]=t[u];var m=e.tagName.toLowerCase();"img"===m?e.src=r(this.srcImage,l,g):"canvas"===m?i(this.srcImage,e,l,g):e.style.backgroundImage="url("+r(this.srcImage,l,g)+")","function"==typeof this.onrender&&this.onrender(e)},"function"==typeof define&&define.amd?define([],function(){return o}):void 0!==a&&a.exports?a.exports=o:this.MegaPixImage=o}()});